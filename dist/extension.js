"use strict";var ie=Object.create;var E=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ce=(o,e)=>{for(var t in e)E(o,t,{get:e[t],enumerable:!0})},q=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ne(e))!re.call(o,a)&&a!==t&&E(o,a,{get:()=>e[a],enumerable:!(i=ae(e,a))||i.enumerable});return o};var C=(o,e,t)=>(t=o!=null?ie(se(o)):{},q(e||!o||!o.__esModule?E(t,"default",{value:o,enumerable:!0}):t,o)),le=o=>q(E({},"__esModule",{value:!0}),o);var he={};ce(he,{activate:()=>fe,deactivate:()=>me});module.exports=le(he);var y=C(require("vscode"));var U=C(require("vscode")),x=class o{constructor(e){this.context=e;e.globalState.setKeysForSync([o.SERVER_URL_KEY])}static SERVER_URL_KEY="coolify.serverUrl";static TOKEN_KEY="coolify.token";static TOKEN_FALLBACK_KEY="coolify.token.fallback";static SECRETS_SUPPORTED_KEY="coolify.secretsSupported";secretsAvailable;async isConfigured(){let e=await this.getServerUrl(),t=await this.getToken();return!!e&&!!t}async getServerUrl(){let e=U.workspace.getConfiguration("coolify").get("serverUrl");return e&&e.trim()!==""?e.trim():this.context.globalState.get(o.SERVER_URL_KEY)}async getToken(){return await this.hasSecretsSupport()?this.context.secrets.get(o.TOKEN_KEY):this.context.globalState.get(o.TOKEN_FALLBACK_KEY)}async setServerUrl(e){await this.context.globalState.update(o.SERVER_URL_KEY,e)}async setToken(e){await this.hasSecretsSupport()?await this.context.secrets.store(o.TOKEN_KEY,e):(await this.context.globalState.update(o.TOKEN_FALLBACK_KEY,e),U.window.showWarningMessage("Coolify: Your editor does not support secure secret storage. Your API token has been stored without encryption. Consider upgrading your editor or using a `.env` file."))}async clearConfiguration(){await this.context.globalState.update(o.SERVER_URL_KEY,void 0),await this.hasSecretsSupport()?await this.context.secrets.delete(o.TOKEN_KEY):await this.context.globalState.update(o.TOKEN_FALLBACK_KEY,void 0)}async hasSecretsSupport(){if(this.secretsAvailable!==void 0)return this.secretsAvailable;try{await this.context.secrets.get("__coolify_probe__"),this.secretsAvailable=!0}catch{this.secretsAvailable=!1,console.warn("[Coolify] SecretStorage not available in this editor \u2014 using plaintext fallback.")}return this.secretsAvailable}};var v=C(require("vscode"));var u=class{constructor(e,t){this.baseUrl=e;this.token=t}async fetchWithAuth(e,t){let i=new AbortController,a=setTimeout(()=>i.abort(),15e3);try{let n=await fetch(`${this.baseUrl}${e}`,{...t,headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json",...t?.headers||{}},signal:i.signal});if(!n.ok)throw new Error(`API request failed (${n.status}): ${n.statusText}`);return await n.json()}finally{clearTimeout(a)}}async fetchVoid(e,t="GET"){let i=new AbortController,a=setTimeout(()=>i.abort(),15e3);try{let n=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{Authorization:`Bearer ${this.token}`},signal:i.signal});if(!n.ok)throw new Error(`Request failed (${n.status}): ${n.statusText}`);return!0}finally{clearTimeout(a)}}async getApplications(){return this.fetchWithAuth("/api/v1/applications")}async getApplicationsByEnvironment(e,t){return(await this.fetchWithAuth(`/api/v1/projects/${e}/environment/${t}`)).applications??[]}async getApplicationLogs(e){let t=new AbortController,i=setTimeout(()=>t.abort(),15e3);try{let a=await fetch(`${this.baseUrl}/api/v1/applications/${e}/logs`,{headers:{Authorization:`Bearer ${this.token}`},signal:t.signal});if(!a.ok)throw new Error(`Failed to fetch logs: ${a.statusText}`);return await a.text()}finally{clearTimeout(i)}}async startApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/start`)}async stopApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/stop`)}async restartApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/restart`)}async getDeployments(){return this.fetchWithAuth("/api/v1/deployments")}async getApplicationDeployments(e){return this.fetchWithAuth(`/api/v1/applications/${e}/deployments`)}async startDeployment(e){return this.fetchVoid(`/api/v1/deploy?uuid=${e}`)}async cancelDeployment(e){return this.fetchVoid(`/api/v1/deployments/${e}/cancel`,"POST")}async getProjects(){return this.fetchWithAuth("/api/v1/projects")}async getProjectEnvironments(e){return(await this.fetchWithAuth(`/api/v1/projects/${e}`)).environments??[]}async getServers(){return this.fetchWithAuth("/api/v1/servers")}async getDatabases(){return this.fetchWithAuth("/api/v1/databases")}async startDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/start`)}async stopDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/stop`)}async createDatabaseBackup(e){return this.fetchVoid(`/api/v1/databases/${e}/backup`,"POST")}async verifyToken(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/v1/version`,{headers:{Authorization:`Bearer ${this.token}`},signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async testConnection(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/health`,{signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async getVersion(){let e=await this.fetchWithAuth("/api/v1/version");return typeof e=="string"?e:e.version??"unknown"}};var N=class{constructor(e){this.configManager=e}items=[];pollInterval;isDisposed=!1;async initialize(){await this.refreshStatusBar(),this.startPolling()}startPolling(){let e=v.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.pollInterval=setInterval(async()=>{this.isDisposed||await this.refreshStatusBar()},e)}async refreshStatusBar(){if(this.isDisposed)return;let e=await this.configManager.isConfigured();if(this.clearItems(),!!e)try{let t=await this.configManager.getServerUrl(),i=await this.configManager.getToken();if(!t||!i)return;let n=await new u(t,i).getApplications(),s=v.workspace.getConfiguration("coolify").get("defaultApplication"),c=s?n.filter(r=>r.id===s||r.uuid===s):n.slice(0,2);for(let r of c){let d=v.window.createStatusBarItem(v.StatusBarAlignment.Left,100);d.name=`Coolify \u2014 ${r.name}`;let m=this.getStatusIcon(r.status);d.text=`${m} ${r.name}: ${this.formatStatus(r.status)}`,d.tooltip=new v.MarkdownString(`**Coolify App: ${r.name}**

Status: \`${r.status}\`

Click to view logs`),d.command={title:"View Logs",command:"coolify.viewApplicationLogs",arguments:[{id:r.id||r.uuid,name:r.name}]},this.applyStatusBackground(d,r.status),d.show(),this.items.push(d)}}catch(t){console.error("StatusBarManager: Failed to refresh:",t)}}getStatusIcon(e){switch(e?.toLowerCase()){case"running":return"$(vm-running)";case"stopped":case"exited":return"$(vm-outline)";case"deploying":case"starting":return"$(sync~spin)";case"error":case"failed":return"$(error)";default:return"$(circle-outline)"}}formatStatus(e){return e?e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "):"Unknown"}applyStatusBackground(e,t){switch(t?.toLowerCase()){case"error":case"failed":e.backgroundColor=new v.ThemeColor("statusBarItem.errorBackground");break;case"deploying":case"starting":e.backgroundColor=new v.ThemeColor("statusBarItem.warningBackground");break;default:e.backgroundColor=void 0}}clearItems(){for(let e of this.items)e.dispose();this.items=[]}dispose(){this.isDisposed=!0,this.pollInterval&&clearInterval(this.pollInterval),this.clearItems()}};var l=C(require("vscode"));var f=class extends l.TreeItem{constructor(t,i,a,n,s){super(t,i);this.kind=a;this.rawData=n;this.parentId=s;this.applyKindConfig()}applyKindConfig(){switch(this.kind){case"project":this.iconPath=new l.ThemeIcon("folder"),this.contextValue="coolifyProject";break;case"environment":this.iconPath=new l.ThemeIcon("layers"),this.contextValue="coolifyEnvironment";break;case"application":{let t=this.rawData;this.iconPath=this.getAppIcon(t?.status),this.contextValue=`coolifyApp_${t?.status?.toLowerCase()??"unknown"}`,t?.fqdn&&(this.description=t.fqdn.replace(/^https?:\/\//,"")),this.tooltip=this.buildAppTooltip(t);break}case"server":{let t=this.rawData,i=t?.settings?.is_reachable;this.iconPath=new l.ThemeIcon(i?"server-process":"server-environment"),this.contextValue="coolifyServer",this.description=t?.ip;break}case"database":{let t=this.rawData;this.iconPath=new l.ThemeIcon("database"),this.contextValue=`coolifyDatabase_${t?.status?.toLowerCase()??"unknown"}`,this.description=t?.type;break}case"category":this.iconPath=new l.ThemeIcon("list-unordered"),this.contextValue="coolifyCategory";break;case"loading":this.iconPath=new l.ThemeIcon("loading~spin"),this.contextValue="coolifyLoading";break;case"empty":this.iconPath=new l.ThemeIcon("info"),this.contextValue="coolifyEmpty";break}}getAppIcon(t){switch(t?.toLowerCase()){case"running":return new l.ThemeIcon("vm-running",new l.ThemeColor("charts.green"));case"stopped":case"exited":return new l.ThemeIcon("vm-outline",new l.ThemeColor("charts.gray"));case"deploying":case"starting":return new l.ThemeIcon("sync~spin",new l.ThemeColor("charts.yellow"));case"error":case"failed":return new l.ThemeIcon("error",new l.ThemeColor("charts.red"));default:return new l.ThemeIcon("circle-outline")}}buildAppTooltip(t){if(!t)return new l.MarkdownString("No application data");let i=[`**${t.name}**`,"",`Status: \`${t.status??"unknown"}\``];return t.git_repository&&i.push(`Repo: \`${t.git_repository}\``),t.git_branch&&i.push(`Branch: \`${t.git_branch}\``),t.fqdn&&i.push(`URL: [${t.fqdn}](${t.fqdn})`),new l.MarkdownString(i.join(`
`))}},L=class{constructor(e){this.configManager=e}_onDidChangeTreeData=new l.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refreshInterval;isDisposed=!1;service;cachedProjects=[];cachedApplications=[];cachedServers=[];cachedDatabases=[];isConfigured=!1;async initialize(){await this.loadData(),this.startAutoRefresh()}startAutoRefresh(){let e=l.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.refreshInterval=setInterval(()=>{this.isDisposed||this.loadData().catch(console.error)},e)}async getService(){let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();return!e||!t?null:(this.service=new u(e,t),this.service)}async loadData(){if(this.isConfigured=await this.configManager.isConfigured(),!this.isConfigured){this.refresh();return}try{let e=await this.getService();if(!e)return;let[t,i,a,n]=await Promise.allSettled([e.getProjects(),e.getApplications(),e.getServers(),e.getDatabases()]);this.cachedProjects=t.status==="fulfilled"?t.value:[],this.cachedApplications=i.status==="fulfilled"?i.value:[],this.cachedServers=a.status==="fulfilled"?a.value:[],this.cachedDatabases=n.status==="fulfilled"?n.value:[],this.refresh()}catch(e){console.error("CoolifyTreeDataProvider: Failed to load data:",e)}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!this.isConfigured)return[new f("Not configured \u2014 run Coolify: Configure",l.TreeItemCollapsibleState.None,"empty")];if(!e)return[new f("Applications",l.TreeItemCollapsibleState.Expanded,"category"),new f("Servers",l.TreeItemCollapsibleState.Collapsed,"category"),new f("Databases",l.TreeItemCollapsibleState.Collapsed,"category")];if(e.kind==="category")return this.getCategoryChildren(e.label);if(e.kind==="project"){let t=e.rawData;return!t.environments||t.environments.length===0?[new f("No environments",l.TreeItemCollapsibleState.None,"empty")]:t.environments.map(i=>new f(i.name,l.TreeItemCollapsibleState.Collapsed,"environment",i,String(t.uuid)))}if(e.kind==="environment"){let t=e.rawData,i=this.cachedApplications.filter(a=>t.applications?t.applications.some(n=>n.id===a.id):!0);return i.length===0?[new f("No applications",l.TreeItemCollapsibleState.None,"empty")]:i.map(a=>new f(a.name,l.TreeItemCollapsibleState.None,"application",a))}return[]}getCategoryChildren(e){switch(e){case"Applications":return this.cachedApplications.length===0?[new f("No applications found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedApplications.map(t=>new f(t.name,l.TreeItemCollapsibleState.None,"application",t));case"Servers":return this.cachedServers.length===0?[new f("No servers found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedServers.map(t=>new f(t.name,l.TreeItemCollapsibleState.None,"server",t));case"Databases":return this.cachedDatabases.length===0?[new f("No databases found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedDatabases.map(t=>new f(t.name,l.TreeItemCollapsibleState.None,"database",t));default:return[]}}getService_(){return this.service}getCachedApplications(){return this.cachedApplications}getCachedDatabases(){return this.cachedDatabases}dispose(){this.isDisposed=!0,this.refreshInterval&&clearInterval(this.refreshInterval),this._onDidChangeTreeData.dispose()}};var g=C(require("vscode"));var A=C(require("vscode"));function j(o){try{!o.startsWith("http://")&&!o.startsWith("https://")&&(o="http://"+o);let e=new URL(o),t=e.hostname,i=t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)||t.includes(".");return t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)?!!e.port:i}catch{return!1}}function W(o){return!o.startsWith("http://")&&!o.startsWith("https://")&&(o="http://"+o),o.replace(/\/$/,"")}async function O(o,e){try{let t=await A.window.showInputBox({ignoreFocusOut:!0,prompt:"Enter your Coolify server URL along with the port",placeHolder:"e.g., http://127.0.0.1:8000",validateInput:d=>d?j(d)?null:"Invalid URL format":"Server URL is required"});if(!t)return;let i=W(t);if(!await new u(i,"").testConnection())throw new Error("Could not connect to the Coolify server. Please check the URL and try again.");let s=await A.window.showInputBox({ignoreFocusOut:!0,prompt:"Enter your Coolify access token",password:!0,placeHolder:"Your Coolify API token",validateInput:d=>d?null:"Access token is required"});if(!s)return;if(!await new u(i,s).verifyToken())throw new Error("Invalid access token. Please check your token and try again.");await o.setServerUrl(i),await o.setToken(s),await e(),A.window.showInformationMessage("Coolify for VSCode configured successfully!")}catch(t){A.window.showErrorMessage(t instanceof Error?t.message:"Configuration failed. Please try again.")}}async function Y(o,e){await A.window.showWarningMessage("This will clear your existing configuration. Do you want to continue?","Yes","No")==="Yes"&&(await o.clearConfiguration(),await e(),await A.commands.executeCommand("coolify.configure"))}var D=C(require("vscode"));async function F(o){try{let e=await o.getServerUrl(),t=await o.getToken();if(!e||!t)throw new Error("Extension not configured properly");let i=new u(e,t),n=(await i.getDeployments()).filter(c=>c.status==="in_progress"||c.status==="queued");if(!n||n.length===0){D.window.showInformationMessage("No active deployments found");return}let s=await D.window.showQuickPick(n.map(c=>({label:`Cancel: ${c.application_name||"Deployment"}`,description:c.status,detail:c.commit_message||`Deployment ID: ${c.id}`,id:c.id})),{placeHolder:"Select a deployment to cancel",title:"Cancel Deployment"});s&&D.window.withProgress({location:D.ProgressLocation.Notification,title:`Canceling ${s.label}...`,cancellable:!1},async()=>{await i.cancelDeployment(s.id),D.window.showInformationMessage("Successfully canceled deployment.")})}catch(e){D.window.showErrorMessage(e instanceof Error?e.message:"Failed to cancel deployment")}}var S=C(require("vscode"));async function B(o,e,t,i,a){try{let n=await o.getServerUrl(),s=await o.getToken();if(!n||!s)throw new Error("Extension not configured properly");let c=new u(n,s),r=i,d=a;if(!r){let m=await c.getApplications();if(!m||m.length===0){S.window.showInformationMessage("No applications found");return}let I=await S.window.showQuickPick(m.map(h=>({label:h.name,description:h.status,detail:`Status: ${h.status}`,id:h.id||h.uuid||""})),{placeHolder:`Select an application to ${e}`,title:t});if(!I)return;r=I.id,d=I.label}await S.window.withProgress({location:S.ProgressLocation.Notification,title:`${e}ing ${d}...`,cancellable:!1},async()=>{e==="start"?await c.startApplication(r):e==="stop"?await c.stopApplication(r):await c.restartApplication(r),S.window.showInformationMessage(`\u2705 Successfully ${e}ed ${d}`)})}catch(n){S.window.showErrorMessage(n instanceof Error?n.message:`Failed to ${e} application`)}}async function H(o,e,t,i){await B(e,"start","Start Application",t,i)}async function z(o,e,t,i){await B(e,"stop","Stop Application",t,i)}async function Q(o,e,t,i){await B(e,"restart","Restart Application",t,i)}var w=C(require("vscode"));var R;function de(){return R||(R=w.window.createOutputChannel("Coolify Logs")),R}async function M(o,e){try{let t=await o.getServerUrl(),i=await o.getToken();if(!t||!i)throw new Error("Extension not configured properly");let a=new u(t,i),n=e?.id,s=e?.name;if(!n){let r=await a.getApplications();if(!r||r.length===0){w.window.showInformationMessage("No applications found");return}let d=await w.window.showQuickPick(r.map(m=>({label:m.name,description:m.status,detail:m.fqdn,id:m.id||m.uuid||""})),{placeHolder:"Select an application to view logs",title:"Coolify: View Logs"});if(!d)return;n=d.id,s=d.label}let c=de();c.clear(),c.show(!0),c.appendLine(`\u2500\u2500 Coolify Logs \u2014 ${s} \u2500\u2500`),c.appendLine(`Fetching logs from ${t}...`),c.appendLine(""),await w.window.withProgress({location:w.ProgressLocation.Notification,title:`Fetching logs for ${s}...`,cancellable:!1},async()=>{let r=await a.getApplicationLogs(n);c.appendLine(r||"(No log output)")})}catch(t){w.window.showErrorMessage(t instanceof Error?t.message:"Failed to fetch logs")}}async function V(o,e){try{let t=await o.getServerUrl(),i=await o.getToken();if(!t||!i)throw new Error("Extension not configured properly");let a=new u(t,i),n=e?.id,s=e?.name;if(!n){let c=await a.getDatabases();if(!c||c.length===0){w.window.showInformationMessage("No databases found");return}let r=await w.window.showQuickPick(c.map(d=>({label:d.name,description:d.type,detail:d.status,id:d.uuid})),{placeHolder:"Select a database to back up",title:"Coolify: Create Database Backup"});if(!r)return;n=r.id,s=r.label}await w.window.withProgress({location:w.ProgressLocation.Notification,title:`Creating backup for ${s}...`,cancellable:!1},async()=>{await a.createDatabaseBackup(n),w.window.showInformationMessage(`\u2705 Backup created for ${s}`)})}catch(t){w.window.showErrorMessage(t instanceof Error?t.message:"Failed to create backup")}}var p=C(require("vscode"));async function G(o,e,t){let i,a="";if(t?.kind==="application"&&t.rawData){let s=t.rawData;i=s.fqdn,a=s.name}else{let s=e.getCachedApplications().filter(r=>!!r.fqdn);if(s.length===0){p.window.showInformationMessage("No applications have a public URL configured in Coolify.");return}let c=await p.window.showQuickPick(s.map(r=>({label:r.name,description:r.fqdn.replace(/^https?:\/\//,""),detail:`Status: ${r.status??"unknown"}`,fqdn:r.fqdn})),{placeHolder:"Select an application to open",title:"Open in Browser"});if(!c)return;i=c.fqdn,a=c.label}if(!i){p.window.showWarningMessage(`${a} has no public URL configured in Coolify.`);return}let n=p.Uri.parse(i.startsWith("http")?i:`https://${i}`);await p.env.openExternal(n)}async function J(o,e){let t,i="";if(e?.rawData){let a=e.rawData;t=a.uuid??a.uuid,i=a.name??a.name}else{let a=o.getCachedApplications(),n=o.getCachedDatabases(),s=[...a.map(r=>({label:r.name,description:`App \xB7 ${r.uuid}`,uuid:r.uuid})),...n.map(r=>({label:r.name,description:`DB \xB7 ${r.uuid}`,uuid:r.uuid}))];if(s.length===0){p.window.showInformationMessage("No resources found to copy UUID from.");return}let c=await p.window.showQuickPick(s,{placeHolder:"Select a resource to copy its UUID",title:"Copy UUID"});if(!c)return;t=c.uuid,i=c.label}if(!t){p.window.showWarningMessage("UUID not available for this resource.");return}await p.env.clipboard.writeText(t),p.window.showInformationMessage(`\u2705 UUID for "${i}" copied to clipboard!`)}async function X(o,e){let t=e.getCachedApplications();if(t.length===0){p.window.showInformationMessage("No applications found. Try refreshing.");return}let i=r=>{switch(r?.toLowerCase()){case"running":return"\u{1F7E2}";case"stopped":case"exited":return"\u{1F534}";case"deploying":case"starting":return"\u{1F7E1}";case"error":case"failed":return"\u274C";default:return"\u26AA"}},a=await p.window.showQuickPick(t.map(r=>({label:`${i(r.status)} ${r.name}`,description:r.fqdn?.replace(/^https?:\/\//,"")??"",detail:`Status: ${r.status??"unknown"} \xB7 ${r.git_branch?`Branch: ${r.git_branch}`:""}`,uuid:r.uuid??r.id??"",name:r.name})),{placeHolder:"Type to filter, select to deploy immediately",title:"\u26A1 Quick Deploy",matchOnDescription:!0,matchOnDetail:!0});if(!a)return;let n=await o.getServerUrl(),s=await o.getToken();if(!n||!s){p.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let c=new u(n,s);await p.window.withProgress({location:p.ProgressLocation.Notification,title:`\u{1F680} Deploying ${a.name}\u2026`,cancellable:!1},async()=>{try{await c.startDeployment(a.uuid),p.window.showInformationMessage(`\u{1F680} ${a.name} deployment started!`,"View Logs").then(r=>{r==="View Logs"&&p.commands.executeCommand("coolify.viewApplicationLogs",{id:a.uuid,name:a.name})})}catch(r){p.window.showErrorMessage(`Deploy failed: ${r instanceof Error?r.message:String(r)}`)}})}async function Z(o){let e=await o.getServerUrl(),t=await o.getToken();if(!e||!t){p.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}await p.window.withProgress({location:p.ProgressLocation.Notification,title:"Testing Coolify connection\u2026",cancellable:!1},async()=>{try{let a=await new u(e,t).getVersion();p.window.showInformationMessage(`\u2705 Connected to Coolify v${a} at ${e.replace(/^https?:\/\//,"")}`)}catch(i){p.window.showErrorMessage(`\u274C Connection failed: ${i instanceof Error?i.message:String(i)}`)}})}var b=C(require("vscode"));function ee(o,e,t){let i=b.extensions.getExtension("vscode.git");if(!i)return;let a=i.isActive?i.exports:null;if(!a)return;let n=a.getAPI(1);if(n?.repositories?.length)for(let s of n.repositories)o.subscriptions.push(s.state.onDidChange(async()=>{let c=s.state.HEAD?.name;if(!c||!await e.isConfigured())return;let d=t.getCachedApplications().filter(h=>h.git_branch===c&&h.status!=="deploying");if(d.length===0)return;let m=`coolify.gitAdvisor.${c}`,I=o.globalState.get(m)??0;if(!(Date.now()-I<3e4))if(await o.globalState.update(m,Date.now()),d.length===1){let h=d[0];await b.window.showInformationMessage(`Coolify: "${h.name}" is configured to deploy from \`${c}\`. Deploy now?`,"Deploy","Dismiss")==="Deploy"&&b.commands.executeCommand("coolify.startDeployment",{kind:"application",rawData:h})}else{let h=await e.getServerUrl(),_=await e.getToken();if(!h||!_)return;let $=await b.window.showQuickPick(d.map(T=>({label:T.name,description:T.fqdn??"",detail:`Branch: ${T.git_branch}`,uuid:T.uuid??T.id??""})),{title:`Deploy from ${c}?`,placeHolder:"Select an app to deploy (Escape to skip)"});if($){let T=new u(h,_);await b.window.withProgress({location:b.ProgressLocation.Notification,title:`\u{1F680} Deploying ${$.label}\u2026`,cancellable:!1},async()=>{await T.startDeployment($.uuid),b.window.showInformationMessage(`\u{1F680} ${$.label} deployment started!`)})}}}))}function te(o,e,t,i){let a=(n,s)=>o.subscriptions.push(g.commands.registerCommand(n,s));a("coolify.configure",()=>O(e,i)),a("coolify.reconfigure",()=>Y(e,i)),a("coolify.refreshApplications",async()=>{await t.loadData(),g.window.showInformationMessage("Coolify: Refreshed")}),a("coolify.startDeployment",n=>{if(n?.kind==="application"&&n.rawData){let s=n.rawData;return oe(e,s.id||s.uuid||"")}return pe(e,t)}),a("coolify.cancelDeployment",()=>F(e)),a("coolify.startApplication",n=>{if(n?.kind==="application"&&n.rawData){let s=n.rawData;return K(e,s.id||s.uuid||"",s.name,"start")}return H(void 0,e)}),a("coolify.stopApplication",n=>{if(n?.kind==="application"&&n.rawData){let s=n.rawData;return K(e,s.id||s.uuid||"",s.name,"stop")}return z(void 0,e)}),a("coolify.restartApplication",n=>{if(n?.kind==="application"&&n.rawData){let s=n.rawData;return K(e,s.id||s.uuid||"",s.name,"restart")}return Q(void 0,e)}),a("coolify.viewApplicationLogs",n=>{if(n&&"kind"in n&&n.kind==="application"&&n.rawData){let s=n.rawData;return M(e,{id:s.id||s.uuid||"",name:s.name})}return n&&"id"in n?M(e,n):M(e)}),a("coolify.createDatabaseBackup",n=>{if(n?.kind==="database"&&n.rawData){let s=n.rawData;return V(e,{id:s.uuid,name:s.name})}return V(e)}),a("coolify.openInBrowser",n=>G(e,t,n)),a("coolify.copyUuid",n=>J(t,n)),a("coolify.quickDeploy",()=>X(e,t)),a("coolify.testConnection",()=>Z(e)),ee(o,e,t)}async function pe(o,e){let t=e.getCachedApplications();if(!t||t.length===0){g.window.showInformationMessage("No applications found");return}let i=await g.window.showQuickPick(t.map(a=>({label:a.name,description:a.status,detail:a.fqdn,id:a.id||a.uuid||""})),{placeHolder:"Select an application to deploy",title:"Start Deployment"});i&&await oe(o,i.id)}async function oe(o,e){let t=await o.getServerUrl(),i=await o.getToken();if(!t||!i)throw new Error("Not configured");let a=new u(t,i);await g.window.withProgress({location:g.ProgressLocation.Notification,title:"Starting deployment...",cancellable:!1},async()=>{await a.startDeployment(e),g.window.showInformationMessage("\u{1F680} Deployment started!")})}async function K(o,e,t,i){let a=await o.getServerUrl(),n=await o.getToken();if(!a||!n)throw new Error("Not configured");let s=new u(a,n);await g.window.withProgress({location:g.ProgressLocation.Notification,title:`${i}ing ${t}...`,cancellable:!1},async()=>{i==="start"?await s.startApplication(e):i==="stop"?await s.stopApplication(e):await s.restartApplication(e),g.window.showInformationMessage(`\u2705 ${t} ${i}ed`)})}function ue(){let o=y.env.appName??"",e=o.toLowerCase();return{name:o,isCursor:e.includes("cursor"),isTrae:e.includes("trae"),isWindsurf:e.includes("windsurf"),isVSCodium:e.includes("vscodium")||e.includes("codium"),isAntigravity:e.includes("antigravity")}}var k,P;function fe(o){let e=ue();console.log(`[Coolify] Running in: ${e.name}`);let t=y.env.remoteName!==void 0&&y.env.remoteName!=="",i=o.globalState.get("coolify.remoteAdvisoryShown");t&&!i&&y.window.showInformationMessage(`Coolify: You are in a remote session (${y.env.remoteName}). Make sure your Coolify server is reachable FROM this remote host.`,"Got it").then(()=>{o.globalState.update("coolify.remoteAdvisoryShown",!0)});let a=new x(o);k=new L(a);let n=y.window.createTreeView("coolify-deployments",{treeDataProvider:k,showCollapseAll:!0});P=new N(a),o.subscriptions.push(n,{dispose:()=>k?.dispose()},{dispose:()=>P?.dispose()});async function s(){let c=await a.isConfigured();await y.commands.executeCommand("setContext","coolify.isConfigured",c),c?(await k?.loadData(),await P?.initialize()):k?.refresh()}s().then(()=>{k?.initialize(),P?.initialize()}),o.subscriptions.push(y.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("coolify")&&s()})),te(o,a,k,s)}function me(){k?.dispose(),P?.dispose()}0&&(module.exports={activate,deactivate});
