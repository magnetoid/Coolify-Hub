"use strict";var he=Object.create;var N=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var be=(n,e)=>{for(var t in e)N(n,t,{get:e[t],enumerable:!0})},O=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ve(e))!ye.call(n,s)&&s!==t&&N(n,s,{get:()=>e[s],enumerable:!(i=me(e,s))||i.enumerable});return n};var b=(n,e,t)=>(t=n!=null?he(we(n)):{},O(e||!n||!n.__esModule?N(t,"default",{value:n,enumerable:!0}):t,n)),Ce=n=>O(N({},"__esModule",{value:!0}),n);var _e={};be(_e,{activate:()=>xe,deactivate:()=>Ee});module.exports=Ce(_e);var S=b(require("vscode"));var B=b(require("vscode")),U=class n{constructor(e){this.context=e;e.globalState.setKeysForSync([n.SERVER_URL_KEY])}static SERVER_URL_KEY="coolify.serverUrl";static TOKEN_KEY="coolify.token";static TOKEN_FALLBACK_KEY="coolify.token.fallback";static SECRETS_SUPPORTED_KEY="coolify.secretsSupported";secretsAvailable;async isConfigured(){let e=await this.getServerUrl(),t=await this.getToken();return!!e&&!!t}async getServerUrl(){let e=B.workspace.getConfiguration("coolify").get("serverUrl");return e&&e.trim()!==""?e.trim():this.context.globalState.get(n.SERVER_URL_KEY)}async getToken(){return await this.hasSecretsSupport()?this.context.secrets.get(n.TOKEN_KEY):this.context.globalState.get(n.TOKEN_FALLBACK_KEY)}async setServerUrl(e){await this.context.globalState.update(n.SERVER_URL_KEY,e)}async setToken(e){await this.hasSecretsSupport()?await this.context.secrets.store(n.TOKEN_KEY,e):(await this.context.globalState.update(n.TOKEN_FALLBACK_KEY,e),B.window.showWarningMessage("Coolify: Your editor does not support secure secret storage. Your API token has been stored without encryption. Consider upgrading your editor or using a `.env` file."))}async clearConfiguration(){await this.context.globalState.update(n.SERVER_URL_KEY,void 0),await this.hasSecretsSupport()?await this.context.secrets.delete(n.TOKEN_KEY):await this.context.globalState.update(n.TOKEN_FALLBACK_KEY,void 0)}async hasSecretsSupport(){if(this.secretsAvailable!==void 0)return this.secretsAvailable;try{await this.context.secrets.get("__coolify_probe__"),this.secretsAvailable=!0}catch{this.secretsAvailable=!1,console.warn("[Coolify] SecretStorage not available in this editor \u2014 using plaintext fallback.")}return this.secretsAvailable}};var P=b(require("vscode")),Z=b(require("child_process")),ee=b(require("util"));var g=class{constructor(e,t){this.baseUrl=e;this.token=t}async fetchWithAuth(e,t){let i=new AbortController,s=setTimeout(()=>i.abort(),15e3);try{let o=await fetch(`${this.baseUrl}${e}`,{...t,headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json",...t?.headers||{}},signal:i.signal});if(!o.ok)throw new Error(`API request failed (${o.status}): ${o.statusText}`);return await o.json()}finally{clearTimeout(s)}}async fetchVoid(e,t="GET"){let i=new AbortController,s=setTimeout(()=>i.abort(),15e3);try{let o=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{Authorization:`Bearer ${this.token}`},signal:i.signal});if(!o.ok)throw new Error(`Request failed (${o.status}): ${o.statusText}`);return!0}finally{clearTimeout(s)}}async getApplications(){return this.fetchWithAuth("/api/v1/applications")}async getApplicationsByEnvironment(e,t){return(await this.fetchWithAuth(`/api/v1/projects/${e}/environment/${t}`)).applications??[]}async getApplicationLogs(e){let t=new AbortController,i=setTimeout(()=>t.abort(),15e3);try{let s=await fetch(`${this.baseUrl}/api/v1/applications/${e}/logs`,{headers:{Authorization:`Bearer ${this.token}`},signal:t.signal});if(!s.ok)throw new Error(`Failed to fetch logs: ${s.statusText}`);return await s.text()}finally{clearTimeout(i)}}async startApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/start`)}async stopApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/stop`)}async restartApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/restart`)}async getDeployments(){return this.fetchWithAuth("/api/v1/deployments")}async getApplicationDeployments(e){return this.fetchWithAuth(`/api/v1/applications/${e}/deployments`)}async startDeployment(e){return(await this.fetchWithAuth(`/api/v1/deploy?uuid=${e}`)).deploy_uuid}async getDeployment(e){return this.fetchWithAuth(`/api/v1/deployments/${e}`)}async cancelDeployment(e){return this.fetchVoid(`/api/v1/deployments/${e}/cancel`,"POST")}async getProjects(){return this.fetchWithAuth("/api/v1/projects")}async getProjectEnvironments(e){return(await this.fetchWithAuth(`/api/v1/projects/${e}`)).environments??[]}async getServers(){return this.fetchWithAuth("/api/v1/servers")}async getDatabases(){return this.fetchWithAuth("/api/v1/databases")}async startDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/start`)}async stopDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/stop`)}async createDatabaseBackup(e){return this.fetchVoid(`/api/v1/databases/${e}/backup`,"POST")}async verifyToken(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/v1/version`,{headers:{Authorization:`Bearer ${this.token}`},signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async testConnection(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/health`,{signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async getVersion(){let e=await this.fetchWithAuth("/api/v1/version");return typeof e=="string"?e:e.version??"unknown"}};var Se=ee.promisify(Z.exec);function X(n){if(!n)return null;let e=n.trim().replace(/\.git$/,""),t=e.match(/[:/]([^/]+\/[^/]+)$/);return t&&t[1]?t[1].toLowerCase():e.toLowerCase()}var j=class{constructor(e){this.configManager=e}items=new Map;pollInterval;isDisposed=!1;isRefreshing=!1;cachedRemotes=null;async getWorkspaceGitRemotes(){if(this.cachedRemotes)return this.cachedRemotes;let e=new Set,t=P.workspace.workspaceFolders;if(!t)return e;for(let i of t)try{let{stdout:s}=await Se("git config --get remote.origin.url",{cwd:i.uri.fsPath}),o=X(s);o&&e.add(o)}catch{}return this.cachedRemotes=e,e}async initialize(){await this.refreshStatusBar(),this.startPolling()}startPolling(){if(this.pollInterval)return;let e=P.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.pollInterval=setInterval(async()=>{this.isDisposed||await this.refreshStatusBar()},e)}async refreshStatusBar(){if(!(this.isDisposed||this.isRefreshing)){this.isRefreshing=!0;try{if(!await this.configManager.isConfigured()){this.clearItems();return}let t=await this.configManager.getServerUrl(),i=await this.configManager.getToken();if(!t||!i)return;let o=await new g(t,i).getApplications(),r=P.workspace.getConfiguration("coolify").get("defaultApplication"),a=[];if(r)a=o.filter(c=>c.id===r||c.uuid===r);else{let c=await this.getWorkspaceGitRemotes();c.size>0&&(a=o.filter(u=>{let f=X(u.git_repository);return f&&c.has(f)}))}let l=a.filter(c=>c.status&&c.status.toLowerCase()!=="unknown"),p=new Set;for(let c of l){let u=c.id||c.uuid;if(!u)continue;p.add(u);let f=this.items.get(u);f||(f=P.window.createStatusBarItem(P.StatusBarAlignment.Left,100),this.items.set(u,f)),f.name=`Coolify \u2014 ${c.name}`;let y=this.getStatusIcon(c.status);f.text=`${y} ${c.name}: ${this.formatStatus(c.status)}`,f.tooltip=new P.MarkdownString(`**Coolify App: ${c.name}**

Status: \`${c.status}\`

Click to view logs`),f.command={title:"View Logs",command:"coolify.viewApplicationLogs",arguments:[{id:u,name:c.name}]},this.applyStatusBackground(f,c.status),f.show()}for(let[c,u]of this.items.entries())p.has(c)||(u.dispose(),this.items.delete(c))}catch(e){console.error("StatusBarManager: Failed to refresh:",e)}finally{this.isRefreshing=!1}}}getStatusIcon(e){let t=e?.toLowerCase()||"";return t.includes("running")?"$(vm-running)":t.includes("stopped")||t.includes("exited")?"$(vm-outline)":t.includes("deploying")||t.includes("starting")?"$(loading~spin)":t.includes("error")||t.includes("failed")?"$(error)":"$(circle-outline)"}formatStatus(e){let t=e?.toLowerCase()||"";return!t||t==="unknown"?"Unknown":t.includes("running")?"Running":t.includes("stopped")||t.includes("exited")?"Stopped":t.includes("deploying")||t.includes("starting")?"Deploying":t.includes("error")||t.includes("failed")?"Error":e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}applyStatusBackground(e,t){let i=t?.toLowerCase()||"";i.includes("error")||i.includes("failed")?e.backgroundColor=new P.ThemeColor("statusBarItem.errorBackground"):i.includes("deploying")||i.includes("starting")?e.backgroundColor=new P.ThemeColor("statusBarItem.warningBackground"):e.backgroundColor=void 0}clearItems(){for(let e of this.items.values())e.dispose();this.items.clear()}dispose(){this.isDisposed=!0,this.pollInterval&&clearInterval(this.pollInterval),this.clearItems()}};var d=b(require("vscode"));var v=class extends d.TreeItem{constructor(t,i,s,o,r){super(t,i);this.kind=s;this.rawData=o;this.parentId=r;this.applyKindConfig()}applyKindConfig(){switch(this.kind){case"project":this.iconPath=new d.ThemeIcon("folder"),this.contextValue="coolifyProject";break;case"environment":this.iconPath=new d.ThemeIcon("layers"),this.contextValue="coolifyEnvironment";break;case"application":{let t=this.rawData;this.iconPath=this.getAppIcon(t?.status),this.contextValue=`coolifyApp_${t?.status?.toLowerCase()??"unknown"}`,t?.fqdn&&(this.description=t.fqdn.replace(/^https?:\/\//,"")),this.tooltip=this.buildAppTooltip(t);break}case"server":{let t=this.rawData,i=t?.settings?.is_reachable;this.iconPath=new d.ThemeIcon(i?"server-process":"server-environment"),this.contextValue="coolifyServer",this.description=t?.ip;break}case"database":{let t=this.rawData;this.iconPath=new d.ThemeIcon("database"),this.contextValue=`coolifyDatabase_${t?.status?.toLowerCase()??"unknown"}`,this.description=t?.type;break}case"category":this.iconPath=new d.ThemeIcon("list-unordered"),this.contextValue="coolifyCategory";break;case"loading":this.iconPath=new d.ThemeIcon("loading~spin"),this.contextValue="coolifyLoading";break;case"empty":this.iconPath=new d.ThemeIcon("info"),this.contextValue="coolifyEmpty";break}}getAppIcon(t){switch(t?.toLowerCase()){case"running":return new d.ThemeIcon("vm-running",new d.ThemeColor("charts.green"));case"stopped":case"exited":return new d.ThemeIcon("vm-outline",new d.ThemeColor("charts.gray"));case"deploying":case"starting":return new d.ThemeIcon("sync~spin",new d.ThemeColor("charts.yellow"));case"error":case"failed":return new d.ThemeIcon("error",new d.ThemeColor("charts.red"));default:return new d.ThemeIcon("circle-outline")}}buildAppTooltip(t){if(!t)return new d.MarkdownString("No application data");let i=[`**${t.name}**`,"",`Status: \`${t.status??"unknown"}\``];return t.git_repository&&i.push(`Repo: \`${t.git_repository}\``),t.git_branch&&i.push(`Branch: \`${t.git_branch}\``),t.fqdn&&i.push(`URL: [${t.fqdn}](${t.fqdn})`),new d.MarkdownString(i.join(`
`))}},V=class{constructor(e){this.configManager=e}_onDidChangeTreeData=new d.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refreshInterval;isDisposed=!1;service;cachedProjects=[];cachedApplications=[];cachedServers=[];cachedDatabases=[];isConfigured=!1;async initialize(){await this.loadData(),this.startAutoRefresh()}startAutoRefresh(){let e=d.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.refreshInterval=setInterval(()=>{this.isDisposed||this.loadData().catch(console.error)},e)}async getService(){let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();return!e||!t?null:(this.service=new g(e,t),this.service)}async loadData(){if(this.isConfigured=await this.configManager.isConfigured(),!this.isConfigured){this.refresh();return}try{let e=await this.getService();if(!e)return;let[t,i,s,o]=await Promise.allSettled([e.getProjects(),e.getApplications(),e.getServers(),e.getDatabases()]);this.cachedProjects=t.status==="fulfilled"?t.value:[],this.cachedApplications=i.status==="fulfilled"?i.value:[],this.cachedServers=s.status==="fulfilled"?s.value:[],this.cachedDatabases=o.status==="fulfilled"?o.value:[],this.refresh()}catch(e){console.error("CoolifyTreeDataProvider: Failed to load data:",e)}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!this.isConfigured){let t=new v("Not signed in \u2014 click to connect",d.TreeItemCollapsibleState.None,"empty");return t.command={command:"coolify.login",title:"Sign In"},[t]}if(!e)return[new v("Projects",d.TreeItemCollapsibleState.Expanded,"category"),new v("Applications",d.TreeItemCollapsibleState.Collapsed,"category"),new v("Servers",d.TreeItemCollapsibleState.Collapsed,"category"),new v("Databases",d.TreeItemCollapsibleState.Collapsed,"category")];if(e.kind==="category")return this.getCategoryChildren(e.label);if(e.kind==="project"){let t=e.rawData;return!t.environments||t.environments.length===0?[new v("No environments",d.TreeItemCollapsibleState.None,"empty")]:t.environments.map(i=>new v(i.name,d.TreeItemCollapsibleState.Collapsed,"environment",i,String(t.uuid)))}if(e.kind==="environment"){let t=e.rawData,i=this.cachedApplications.filter(s=>t.applications?t.applications.some(o=>o.id===s.id):!0);return i.length===0?[new v("No applications",d.TreeItemCollapsibleState.None,"empty")]:i.map(s=>new v(s.name,d.TreeItemCollapsibleState.None,"application",s))}return[]}getCategoryChildren(e){switch(e){case"Projects":return this.cachedProjects.length===0?[new v("No projects found",d.TreeItemCollapsibleState.None,"empty")]:this.cachedProjects.map(t=>new v(t.name,d.TreeItemCollapsibleState.Collapsed,"project",t));case"Applications":return this.cachedApplications.length===0?[new v("No applications found",d.TreeItemCollapsibleState.None,"empty")]:this.cachedApplications.map(t=>new v(t.name,d.TreeItemCollapsibleState.None,"application",t));case"Servers":return this.cachedServers.length===0?[new v("No servers found",d.TreeItemCollapsibleState.None,"empty")]:this.cachedServers.map(t=>new v(t.name,d.TreeItemCollapsibleState.None,"server",t));case"Databases":return this.cachedDatabases.length===0?[new v("No databases found",d.TreeItemCollapsibleState.None,"empty")]:this.cachedDatabases.map(t=>new v(t.name,d.TreeItemCollapsibleState.None,"database",t));default:return[]}}getService_(){return this.service}getCachedApplications(){return this.cachedApplications}getCachedDatabases(){return this.cachedDatabases}dispose(){this.isDisposed=!0,this.refreshInterval&&clearInterval(this.refreshInterval),this._onDidChangeTreeData.dispose()}};var w=b(require("vscode"));var m=b(require("vscode"));var te=require("child_process"),oe=require("util"),De=(0,oe.promisify)(te.exec),Q;function ke(){return Q||(Q=m.window.createOutputChannel("Coolify Build Logs")),Q}async function q(n,e,t="Application"){try{let i=await n.getServerUrl(),s=await n.getToken();if(!i||!s)throw new Error("Not configured");let o=new g(i,s);if(m.workspace.workspaceFolders&&m.workspace.workspaceFolders.length>0){let l=m.workspace.workspaceFolders[0].uri.fsPath;try{await m.window.withProgress({location:m.ProgressLocation.Notification,title:`Pushing local changes for ${t}...`,cancellable:!1},async()=>{await De("git push origin HEAD",{cwd:l})}),m.window.showInformationMessage(`\u2705 Git push successful for ${t}`)}catch(p){console.log("Git push skipped or failed:",p)}}let r=ke();r.clear(),r.show(!0),r.appendLine(`\u2500\u2500 Coolify Deployment Logs: ${t} \u2500\u2500`),r.appendLine("Starting deployment...");let a;await m.window.withProgress({location:m.ProgressLocation.Notification,title:`Deploying ${t}...`,cancellable:!1},async l=>{try{if(a=await o.startDeployment(e),!a){r.appendLine("Deployment started, but no UUID returned to track logs."),m.window.showInformationMessage(`\u{1F680} Deployment started for ${t}`);return}r.appendLine(`Deployment UUID: ${a}`),r.appendLine("Polling for live logs...");let p=!1,c=0;for(;!p;){await new Promise(u=>setTimeout(u,3e3));try{let u=await o.getDeployment(a);if(!u)continue;l.report({message:`Status: ${u.status}`});let f=u;if(f.logs&&typeof f.logs=="string"){let y=f.logs;if(y.length>c){let I=y.substring(c);r.append(I),c=y.length}}(u.status==="finished"||u.status==="failed"||u.status==="error")&&(p=!0,u.status==="finished"?(m.window.showInformationMessage(`\u2705 Deployment successful: ${t}`),r.appendLine(`
[SUCCESS] Deployment finished successfully!`)):(m.window.showErrorMessage(`\u274C Deployment failed: ${t}`),r.appendLine(`
[ERROR] Deployment failed with status: ${u.status}`)))}catch(u){console.error("Polling error:",u)}}}catch(p){m.window.showErrorMessage(`\u274C Deployment failed to start: ${p instanceof Error?p.message:"Unknown"}`),r.appendLine(`
[ERROR] Failed to start: ${p instanceof Error?p.message:"Unknown"}`)}})}catch(i){m.window.showErrorMessage(`Failed to deploy: ${i instanceof Error?i.message:"Unknown"}`)}}async function ie(n){try{let e=await n.getServerUrl(),t=await n.getToken();if(!e||!t)throw new Error("Extension not configured properly");let i=new g(e,t),o=(await i.getDeployments()).filter(a=>a.status==="in_progress"||a.status==="queued");if(!o||o.length===0){m.window.showInformationMessage("No active deployments found");return}let r=await m.window.showQuickPick(o.map(a=>({label:`Cancel: ${a.application_name||"Deployment"}`,description:a.status,detail:a.commit_message||`Deployment ID: ${a.id}`,id:a.id})),{placeHolder:"Select a deployment to cancel",title:"Cancel Deployment"});r&&m.window.withProgress({location:m.ProgressLocation.Notification,title:`Canceling ${r.label}...`,cancellable:!1},async()=>{await i.cancelDeployment(r.id),m.window.showInformationMessage("Successfully canceled deployment.")})}catch(e){m.window.showErrorMessage(e instanceof Error?e.message:"Failed to cancel deployment")}}var x=b(require("vscode"));async function G(n,e,t,i,s){try{let o=await n.getServerUrl(),r=await n.getToken();if(!o||!r)throw new Error("Extension not configured properly");let a=new g(o,r),l=i,p=s;if(!l){let c=await a.getApplications();if(!c||c.length===0){x.window.showInformationMessage("No applications found");return}let u=await x.window.showQuickPick(c.map(f=>({label:f.name,description:f.status,detail:`Status: ${f.status}`,id:f.id||f.uuid||""})),{placeHolder:`Select an application to ${e}`,title:t});if(!u)return;l=u.id,p=u.label}await x.window.withProgress({location:x.ProgressLocation.Notification,title:`${e}ing ${p}...`,cancellable:!1},async()=>{e==="start"?await a.startApplication(l):e==="stop"?await a.stopApplication(l):await a.restartApplication(l),x.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&x.window.showInformationMessage(`\u2705 Successfully ${e}ed ${p}`)})}catch(o){x.window.showErrorMessage(o instanceof Error?o.message:`Failed to ${e} application`)}}async function se(n,e,t,i){await G(e,"start","Start Application",t,i)}async function ne(n,e,t,i){await G(e,"stop","Stop Application",t,i)}async function ae(n,e,t,i){await G(e,"restart","Restart Application",t,i)}var D=b(require("vscode"));async function re(n,e,t,i,s){let o=i,r=s||"Database";if(!o){let c=await n.getServerUrl(),u=await n.getToken();if(!c||!u){D.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let f=new g(c,u),y=[];if(await D.window.withProgress({location:D.ProgressLocation.Notification,title:"Fetching databases..."},async()=>{y=await f.getDatabases()}),!y||y.length===0){D.window.showInformationMessage("No databases found.");return}let I=await D.window.showQuickPick(y.map(C=>({label:C.name,description:C.status,detail:C.type,id:C.uuid})),{placeHolder:`Select a database to ${e}`,title:t});if(!I)return;o=I.id,r=I.label}if(!o)return;let a=await n.getServerUrl(),l=await n.getToken();if(!a||!l){D.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let p=new g(a,l);await D.window.withProgress({location:D.ProgressLocation.Notification,title:`${t} for ${r}...`,cancellable:!1},async()=>{try{e==="start"?await p.startDatabase(o):e==="stop"&&await p.stopDatabase(o),D.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&D.window.showInformationMessage(`\u2705 ${r} ${e} command sent successfully`)}catch(c){D.window.showErrorMessage(`Failed to ${e} ${r}`),console.error(`Error in database action (${e}):`,c)}})}async function F(n,e,t,i){await re(e,"start","Start Database",t,i)}async function K(n,e,t,i){await re(e,"stop","Stop Database",t,i)}var k=b(require("vscode"));var J;function Ae(){return J||(J=k.window.createOutputChannel("Coolify Logs")),J}async function R(n,e){try{let t=await n.getServerUrl(),i=await n.getToken();if(!t||!i)throw new Error("Extension not configured properly");let s=new g(t,i),o=e?.id,r=e?.name;if(!o){let l=await s.getApplications();if(!l||l.length===0){k.window.showInformationMessage("No applications found");return}let p=await k.window.showQuickPick(l.map(c=>({label:c.name,description:c.status,detail:c.fqdn,id:c.id||c.uuid||""})),{placeHolder:"Select an application to view logs",title:"Coolify: View Logs"});if(!p)return;o=p.id,r=p.label}let a=Ae();a.clear(),a.show(!0),a.appendLine(`\u2500\u2500 Coolify Logs \u2014 ${r} \u2500\u2500`),a.appendLine(`Fetching logs from ${t}...`),a.appendLine(""),await k.window.withProgress({location:k.ProgressLocation.Notification,title:`Fetching logs for ${r}...`,cancellable:!1},async()=>{let l=await s.getApplicationLogs(o);a.appendLine(l||"(No log output)")})}catch(t){k.window.showErrorMessage(t instanceof Error?t.message:"Failed to fetch logs")}}async function W(n,e){try{let t=await n.getServerUrl(),i=await n.getToken();if(!t||!i)throw new Error("Extension not configured properly");let s=new g(t,i),o=e?.id,r=e?.name;if(!o){let a=await s.getDatabases();if(!a||a.length===0){k.window.showInformationMessage("No databases found");return}let l=await k.window.showQuickPick(a.map(p=>({label:p.name,description:p.type,detail:p.status,id:p.uuid})),{placeHolder:"Select a database to back up",title:"Coolify: Create Database Backup"});if(!l)return;o=l.id,r=l.label}await k.window.withProgress({location:k.ProgressLocation.Notification,title:`Creating backup for ${r}...`,cancellable:!1},async()=>{await s.createDatabaseBackup(o),k.window.showInformationMessage(`\u2705 Backup created for ${r}`)})}catch(t){k.window.showErrorMessage(t instanceof Error?t.message:"Failed to create backup")}}var h=b(require("vscode"));async function ce(n,e,t){let i,s="";if(t?.kind==="application"&&t.rawData){let r=t.rawData;i=r.fqdn,s=r.name}else{let r=e.getCachedApplications().filter(l=>!!l.fqdn);if(r.length===0){h.window.showInformationMessage("No applications have a public URL configured in Coolify.");return}let a=await h.window.showQuickPick(r.map(l=>({label:l.name,description:l.fqdn.replace(/^https?:\/\//,""),detail:`Status: ${l.status??"unknown"}`,fqdn:l.fqdn})),{placeHolder:"Select an application to open",title:"Open in Browser"});if(!a)return;i=a.fqdn,s=a.label}if(!i){h.window.showWarningMessage(`${s} has no public URL configured in Coolify.`);return}let o=h.Uri.parse(i.startsWith("http")?i:`https://${i}`);await h.env.openExternal(o)}async function le(n,e){let t,i="";if(e?.rawData){let s=e.rawData;t=s.uuid??s.uuid,i=s.name??s.name}else{let s=n.getCachedApplications(),o=n.getCachedDatabases(),r=[...s.map(l=>({label:l.name,description:`App \xB7 ${l.uuid}`,uuid:l.uuid})),...o.map(l=>({label:l.name,description:`DB \xB7 ${l.uuid}`,uuid:l.uuid}))];if(r.length===0){h.window.showInformationMessage("No resources found to copy UUID from.");return}let a=await h.window.showQuickPick(r,{placeHolder:"Select a resource to copy its UUID",title:"Copy UUID"});if(!a)return;t=a.uuid,i=a.label}if(!t){h.window.showWarningMessage("UUID not available for this resource.");return}await h.env.clipboard.writeText(t),h.window.showInformationMessage(`\u2705 UUID for "${i}" copied to clipboard!`)}async function de(n,e){let t=e.getCachedApplications();if(t.length===0){h.window.showInformationMessage("No applications found. Try refreshing.");return}let i=l=>{switch(l?.toLowerCase()){case"running":return"\u{1F7E2}";case"stopped":case"exited":return"\u{1F534}";case"deploying":case"starting":return"\u{1F7E1}";case"error":case"failed":return"\u274C";default:return"\u26AA"}},s=await h.window.showQuickPick(t.map(l=>({label:`${i(l.status)} ${l.name}`,description:l.fqdn?.replace(/^https?:\/\//,"")??"",detail:`Status: ${l.status??"unknown"} \xB7 ${l.git_branch?`Branch: ${l.git_branch}`:""}`,uuid:l.uuid??l.id??"",name:l.name})),{placeHolder:"Type to filter, select to deploy immediately",title:"\u26A1 Quick Deploy",matchOnDescription:!0,matchOnDetail:!0});if(!s)return;let o=await n.getServerUrl(),r=await n.getToken();if(!o||!r){h.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let a=new g(o,r);await h.window.withProgress({location:h.ProgressLocation.Notification,title:`\u{1F680} Deploying ${s.name}\u2026`,cancellable:!1},async()=>{try{await a.startDeployment(s.uuid),h.window.showInformationMessage(`\u{1F680} ${s.name} deployment started!`,"View Logs").then(l=>{l==="View Logs"&&h.commands.executeCommand("coolify.viewApplicationLogs",{id:s.uuid,name:s.name})})}catch(l){h.window.showErrorMessage(`Deploy failed: ${l instanceof Error?l.message:String(l)}`)}})}async function pe(n){let e=await n.getServerUrl(),t=await n.getToken();if(!e||!t){h.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}await h.window.withProgress({location:h.ProgressLocation.Notification,title:"Testing Coolify connection\u2026",cancellable:!1},async()=>{try{let s=await new g(e,t).getVersion();h.window.showInformationMessage(`\u2705 Connected to Coolify v${s} at ${e.replace(/^https?:\/\//,"")}`)}catch(i){h.window.showErrorMessage(`\u274C Connection failed: ${i instanceof Error?i.message:String(i)}`)}})}var T=b(require("vscode"));function ue(n,e,t){let i=T.extensions.getExtension("vscode.git");if(!i)return;let s=i.isActive?i.exports:null;if(!s)return;let o=s.getAPI(1);if(o?.repositories?.length)for(let r of o.repositories)n.subscriptions.push(r.state.onDidChange(async()=>{let a=r.state.HEAD?.name;if(!a||!await e.isConfigured())return;let p=t.getCachedApplications().filter(f=>f.git_branch===a&&f.status!=="deploying");if(p.length===0)return;let c=`coolify.gitAdvisor.${a}`,u=n.globalState.get(c)??0;if(!(Date.now()-u<3e4))if(await n.globalState.update(c,Date.now()),p.length===1){let f=p[0];await T.window.showInformationMessage(`Coolify: "${f.name}" is configured to deploy from \`${a}\`. Deploy now?`,"Deploy","Dismiss")==="Deploy"&&T.commands.executeCommand("coolify.startDeployment",{kind:"application",rawData:f})}else{let f=await e.getServerUrl(),y=await e.getToken();if(!f||!y)return;let I=await T.window.showQuickPick(p.map(C=>({label:C.name,description:C.fqdn??"",detail:`Branch: ${C.git_branch}`,uuid:C.uuid??C.id??""})),{title:`Deploy from ${a}?`,placeHolder:"Select an app to deploy (Escape to skip)"});if(I){let C=new g(f,y);await T.window.withProgress({location:T.ProgressLocation.Notification,title:`\u{1F680} Deploying ${I.label}\u2026`,cancellable:!1},async()=>{await C.startDeployment(I.uuid),T.window.showInformationMessage(`\u{1F680} ${I.label} deployment started!`)})}}}))}var A=b(require("vscode"));var H=class n{constructor(e,t,i){this.configManager=i;this._panel=e,this._extensionUri=t,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.onDidChangeViewState(s=>{this._panel.visible?this.startAutoRefresh():this.stopAutoRefresh()},null,this._disposables),this._panel.webview.onDidReceiveMessage(s=>{switch(s.type){case"refresh":this.updatePanelData();break;case"openLogs":A.commands.executeCommand("coolify.viewApplicationLogs",s.uuid,s.name);break;case"deployApp":A.commands.executeCommand("coolify.startDeployment",s.uuid);break}},null,this._disposables),this.startAutoRefresh()}static currentPanel;_panel;_extensionUri;_disposables=[];_refreshInterval;static createOrShow(e,t){let i=A.window.activeTextEditor?A.window.activeTextEditor.viewColumn:void 0;if(n.currentPanel){n.currentPanel._panel.reveal(i);return}let s=A.window.createWebviewPanel("coolifyDashboard","Coolify Dashboard",i||A.ViewColumn.One,{enableScripts:!0,localResourceRoots:[A.Uri.joinPath(e,"public")]});n.currentPanel=new n(s,e,t)}startAutoRefresh(){this.stopAutoRefresh(),this.updatePanelData();let e=A.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this._refreshInterval=setInterval(()=>this.updatePanelData(),e)}stopAutoRefresh(){this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=void 0)}async updatePanelData(){if(this._panel.visible)try{let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();if(!e||!t){this._panel.webview.html=this.getNotConfiguredHtml();return}let i=new g(e,t),[s,o,r]=await Promise.all([i.getServers(),i.getApplications(),i.getDatabases()]);this._panel.webview.html=this.getDashboardHtml(s,o,r,e)}catch(e){console.error("Coolify Dashboard error:",e),this._panel.webview.html=`<h1>Error Loading Dashboard</h1><p>${e instanceof Error?e.message:"Unknown error"}</p>`}}getNotConfiguredHtml(){return`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <style>
                    body { display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
                    .container { text-align: center; }
                    button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; }
                    button:hover { background: var(--vscode-button-hoverBackground); }
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>Welcome to Coolify Deployments</h1>
                    <p>Connect your Coolify server to view your dashboard.</p>
                </div>
            </body>
            </html>
        `}getDashboardHtml(e,t,i,s){let o=this._panel.webview.asWebviewUri(A.Uri.joinPath(this._extensionUri,"public","logo.svg")),r=e.map(c=>`
            <div class="card">
                <div class="card-header">
                    <h3>\u{1F5A5}\uFE0F ${c.name}</h3>
                    <span class="badge ${c.settings?.is_reachable?"badge-success":"badge-danger"}">
                        ${c.settings?.is_reachable?"Online":"Unreachable"}
                    </span>
                </div>
                <div class="card-body">
                    <p>IP: <code>${c.ip}</code></p>
                    <p>User: <code>${c.user}</code></p>
                </div>
            </div>
        `).join(""),a={running:"badge-success",deploying:"badge-warning",starting:"badge-warning",stopped:"badge-dark",exited:"badge-dark",error:"badge-danger",failed:"badge-danger"},l=t.map(c=>{let u=a[c.status?.toLowerCase()]||"badge-dark",f=c.name.length>20?c.name.substring(0,20)+"...":c.name,y=c.fqdn?`<a href="${c.fqdn}">${c.fqdn.replace("https://","").replace("http://","")}</a>`:"No URL",I=c.git_repository?`${c.git_repository}@${c.git_branch}`:"N/A",C=c.uuid||c.id;return`
            <div class="card">
                <div class="card-header">
                    <h3 title="${c.name}">${f}</h3>
                    <span class="badge ${u}">${c.status||"unknown"}</span>
                </div>
                <div class="card-body">
                    <p class="truncate" title="${c.fqdn||"No URL"}">\u{1F310} ${y}</p>
                    <p class="truncate" title="${c.git_repository}@${c.git_branch}">\u{1F4E6} ${I}</p>
                </div>
                <div class="card-footer">
                    <button class="icon-btn" onclick="openLogs('${C}', '${c.name}')" title="Logs">\u{1F4CB} Logs</button>
                    <button class="icon-btn deploy-btn" onclick="deployApp('${C}')" title="Deploy">\u{1F680} Deploy</button>
                </div>
            </div>
        `}).join(""),p=i.map(c=>{let u=a[c.status?.toLowerCase()]||"badge-dark";return`
            <div class="card">
                <div class="card-header">
                    <h3>\u{1F5C4}\uFE0F ${c.name}</h3>
                    <span class="badge ${u}">${c.status||"unknown"}</span>
                </div>
                <div class="card-body">
                    <p>Type: <code>${c.type}</code></p>
                </div>
            </div>
        `}).join("");return`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Coolify Dashboard</title>
                <style>
                    :root {
                        --bg: var(--vscode-editor-background);
                        --fg: var(--vscode-editor-foreground);
                        --card-bg: var(--vscode-editorWidget-background);
                        --card-border: var(--vscode-widget-border);
                        --btn-bg: var(--vscode-button-background);
                        --btn-fg: var(--vscode-button-foreground);
                        --btn-hover: var(--vscode-button-hoverBackground);
                        --link: var(--vscode-textLink-foreground);
                    }
                    body {
                        font-family: var(--vscode-font-family), sans-serif;
                        padding: 30px;
                        background-color: var(--bg);
                        color: var(--fg);
                        overflow-y: auto;
                    }
                    header {
                        display: flex;
                        align-items: center;
                        border-bottom: 1px solid var(--card-border);
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    header img { width: 48px; height: 48px; margin-right: 15px; }
                    header h1 { margin: 0; font-weight: 600; font-size: 24px; }
                    header .server-url { margin-left: auto; opacity: 0.6; font-family: monospace; }
                    
                    section { margin-bottom: 40px; }
                    section h2 { margin-bottom: 20px; font-size: 18px; font-weight: 500; border-bottom: 1px dashed var(--card-border); padding-bottom: 8px; display: inline-block; }
                    
                    .grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                        gap: 20px;
                    }
                    
                    .card {
                        background-color: var(--card-bg);
                        border: 1px solid var(--card-border);
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        display: flex;
                        flex-direction: column;
                        transition: transform 0.1s ease, box-shadow 0.1s ease;
                    }
                    .card:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
                    
                    .card-header {
                        padding: 15px;
                        border-bottom: 1px solid var(--card-border);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .card-header h3 { margin: 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
                    
                    .card-body { padding: 15px; flex-grow: 1; }
                    .card-body p { margin: 8px 0; font-size: 13px; opacity: 0.8; }
                    .truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
                    
                    .card-footer {
                        padding: 10px 15px;
                        background-color: rgba(0,0,0,0.1);
                        border-top: 1px solid var(--card-border);
                        display: flex;
                        gap: 10px;
                        justify-content: flex-end;
                    }
                    
                    .badge {
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 11px;
                        font-weight: bold;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    .badge-success { background: #10B981; color: white; }
                    .badge-danger { background: #EF4444; color: white; }
                    .badge-warning { background: #F59E0B; color: white; }
                    .badge-dark { background: #6B7280; color: white; }
                    
                    code {
                        background: rgba(128,128,128,0.2);
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-family: var(--vscode-editor-font-family);
                    }
                    a { color: var(--link); text-decoration: none; }
                    a:hover { text-decoration: underline; }
                    
                    button.icon-btn {
                        background: var(--btn-bg);
                        color: var(--btn-fg);
                        border: none;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                    }
                    button.icon-btn:hover { background: var(--btn-hover); }
                    button.deploy-btn { background: #3B82F6; }
                    button.deploy-btn:hover { background: #2563EB; }
                </style>
            </head>
            <body>
                <header>
                    <img src="${o}" alt="Coolify" />
                    <h1>Coolify Infrastructure</h1>
                    <div class="server-url">${s}</div>
                </header>
                
                <section>
                    <h2>\u{1F5A5}\uFE0F Servers (${e.length})</h2>
                    <div class="grid">${r||"<p>No servers found.</p>"}</div>
                </section>
                
                <section>
                    <h2>\u{1F4E6} Applications (${t.length})</h2>
                    <div class="grid">${l||"<p>No applications found.</p>"}</div>
                </section>
                
                <section>
                    <h2>\u{1F5C4}\uFE0F Databases (${i.length})</h2>
                    <div class="grid">${p||"<p>No databases found.</p>"}</div>
                </section>

                <script>
                    const vscode = acquireVsCodeApi();
                    function openLogs(uuid, name) { vscode.postMessage({ type: 'openLogs', uuid, name }); }
                    function deployApp(uuid) { vscode.postMessage({ type: 'deployApp', uuid }); }
                </script>
            </body>
            </html>
        `}dispose(){for(n.currentPanel=void 0,this._panel.dispose(),this.stopAutoRefresh();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}};function fe(n,e,t,i){let s=(o,r)=>n.subscriptions.push(w.commands.registerCommand(o,r));s("coolify.login",async()=>{try{await w.authentication.getSession("coolify",["coolify"],{createIfNone:!0}),await i(),w.window.showInformationMessage("\u{1F389} Signed in to Coolify!")}catch(o){w.window.showErrorMessage(o instanceof Error?o.message:"Login failed")}}),s("coolify.logout",async()=>{await w.authentication.getSession("coolify",["coolify"])&&(await e.clearConfiguration(),await i(),w.window.showInformationMessage("Signed out of Coolify"))}),s("coolify.refreshApplications",async()=>{await t.loadData(),w.window.showInformationMessage("Coolify: Refreshed")}),s("coolify.openDashboard",()=>{H.createOrShow(n.extensionUri,e)}),s("coolify.startDeployment",(o,r)=>{if(typeof o=="string")return q(e,o,r);if(o?.kind==="application"&&o.rawData){let a=o.rawData;return q(e,a.id||a.uuid||"",a.name)}return Pe(e,t)}),s("coolify.cancelDeployment",()=>ie(e)),s("coolify.startApplication",(o,r)=>{if(typeof o=="string")return L(e,o,r||"Application","start");if(o?.kind==="application"&&o.rawData){let a=o.rawData;return L(e,a.id||a.uuid||"",a.name,"start")}return se(void 0,e)}),s("coolify.stopApplication",(o,r)=>{if(typeof o=="string")return L(e,o,r||"Application","stop");if(o?.kind==="application"&&o.rawData){let a=o.rawData;return L(e,a.id||a.uuid||"",a.name,"stop")}return ne(void 0,e)}),s("coolify.restartApplication",(o,r)=>{if(typeof o=="string")return L(e,o,r||"Application","restart");if(o?.kind==="application"&&o.rawData){let a=o.rawData;return L(e,a.id||a.uuid||"",a.name,"restart")}return ae(void 0,e)}),s("coolify.viewApplicationLogs",(o,r)=>{if(typeof o=="string")return R(e,{id:o,name:r||"Application"});if(o&&"kind"in o&&o.kind==="application"&&o.rawData){let a=o.rawData;return R(e,{id:a.id||a.uuid||"",name:a.name})}else if(o&&typeof o=="object"&&"id"in o)return R(e,o);return R(e)}),s("coolify.startDatabase",(o,r)=>{if(typeof o=="string")return F(void 0,e,o,r);if(o?.kind==="database"&&o.rawData){let a=o.rawData;return F(void 0,e,a.uuid,a.name)}return F(void 0,e)}),s("coolify.stopDatabase",(o,r)=>{if(typeof o=="string")return K(void 0,e,o,r);if(o?.kind==="database"&&o.rawData){let a=o.rawData;return K(void 0,e,a.uuid,a.name)}return K(void 0,e)}),s("coolify.createDatabaseBackup",(o,r)=>{if(typeof o=="string")return W(e,{id:o,name:r||"Database"});if(o?.kind==="database"&&o.rawData){let a=o.rawData;return W(e,{id:a.uuid,name:a.name})}return W(e)}),s("coolify.openInBrowser",o=>ce(e,t,o)),s("coolify.copyUuid",o=>le(t,o)),s("coolify.quickDeploy",()=>de(e,t)),s("coolify.testConnection",()=>pe(e)),ue(n,e,t)}async function Pe(n,e){let t=e.getCachedApplications();if(!t||t.length===0){w.window.showInformationMessage("No applications found");return}let i=await w.window.showQuickPick(t.map(s=>({label:s.name,description:s.status,detail:s.fqdn,id:s.id||s.uuid||""})),{placeHolder:"Select an application to deploy",title:"Start Deployment"});i&&await q(n,i.id,i.label)}async function L(n,e,t,i){let s=await n.getServerUrl(),o=await n.getToken();if(!s||!o)throw new Error("Not configured");let r=new g(s,o);await w.window.withProgress({location:w.ProgressLocation.Notification,title:`${i}ing ${t}...`,cancellable:!1},async()=>{i==="start"?await r.startApplication(e):i==="stop"?await r.stopApplication(e):await r.restartApplication(e),w.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&w.window.showInformationMessage(`\u2705 ${t} ${i}ed`)})}var $=b(require("vscode"));var Ie="coolify",Te="Coolify",ge="coolify.auth.sessions",Y=class{constructor(e,t){this.context=e;this.configManager=t;this._reg=$.authentication.registerAuthenticationProvider(Ie,Te,this,{supportsMultipleAccounts:!1})}_sessions=[];_storedSessions=new Map;_onDidChangeSessions=new $.EventEmitter;onDidChangeSessions=this._onDidChangeSessions.event;_reg;async getSessions(e){return await this._load(),!e||e.length===0?this._sessions:this._sessions.filter(t=>e.every(i=>t.scopes.includes(i)))}async createSession(e){let t=await this.configManager.getServerUrl();if(!t){let o=await $.window.showInputBox({ignoreFocusOut:!0,title:"Connect to Coolify",prompt:"Enter your Coolify server URL",placeHolder:"https://coolify.my-server.com",validateInput:r=>r?null:"URL is required"});if(!o)throw new Error("Cancelled");t=o.replace(/\/$/,""),await this.configManager.setServerUrl(t)}await $.env.openExternal($.Uri.parse(`${t}/security/api-tokens`));let i=await $.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Paste API Token",prompt:"\u{1F510} Paste your API token from the browser tab that just opened",password:!0,placeHolder:"Paste token here\u2026",validateInput:o=>o?null:"Token is required"});if(!i)throw new Error("Cancelled");if(!await new g(t,i).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");return await this.configManager.setToken(i),this._storeSession(t,i,[...e])}async removeSession(e){let t=this._sessions.find(i=>i.id===e);this._sessions=this._sessions.filter(i=>i.id!==e),this._storedSessions.delete(e),await this._save(),await this.configManager.clearConfiguration(),t&&this._onDidChangeSessions.fire({added:[],removed:[t],changed:[]})}async createSessionFromToken(e,t){await this.configManager.setServerUrl(e),await this.configManager.setToken(t),this._storeSession(e,t,["coolify"])}_storeSession(e,t,i){let s=`coolify-${Date.now()}`,o=Array.from(i),r={id:s,accessToken:t,account:{id:e,label:e.replace(/^https?:\/\//,"")},scopes:o};return this._sessions=[r],this._storedSessions.set(s,{...r,scopes:o,serverUrl:e}),this._save(),this._onDidChangeSessions.fire({added:[r],removed:[],changed:[]}),r}async _load(){let e=this.context.globalState.get(ge,[]);this._sessions=e.map(t=>({id:t.id,accessToken:t.accessToken,account:t.account,scopes:t.scopes})),e.forEach(t=>this._storedSessions.set(t.id,t))}async _save(){await this.context.globalState.update(ge,[...this._storedSessions.values()])}dispose(){this._reg.dispose(),this._onDidChangeSessions.dispose()}};var E=b(require("vscode"));var z=class{constructor(e,t,i){this.authProvider=e;this.configManager=t;this.onAuthenticated=i}async handleUri(e){let t=new URLSearchParams(e.query),i=t.get("token"),s=t.get("url"),o=e.path;if(o==="/auth"||o==="/callback"){if(!i||!s){E.window.showErrorMessage("Coolify: Invalid auth link \u2014 missing token or server URL.");return}let r=decodeURIComponent(s).replace(/\/$/,""),a=decodeURIComponent(i),l=new g(r,a);await E.window.withProgress({location:E.ProgressLocation.Notification,title:`\u{1F510} Authenticating with Coolify at ${r.replace(/^https?:\/\//,"")}\u2026`,cancellable:!1},async()=>{if(!await l.verifyToken()){E.window.showErrorMessage("Coolify: The token from the deep link is invalid or expired.");return}await this.authProvider.createSessionFromToken(r,a),await this.onAuthenticated(),E.window.showInformationMessage(`\u2705 Authenticated with Coolify at ${r.replace(/^https?:\/\//,"")}!`,"Open Sidebar").then(c=>{c==="Open Sidebar"&&E.commands.executeCommand("coolify-deployments.focus")})})}}};function $e(){let n=S.env.appName??"",e=n.toLowerCase();return{name:n,isCursor:e.includes("cursor"),isTrae:e.includes("trae"),isWindsurf:e.includes("windsurf"),isVSCodium:e.includes("vscodium")||e.includes("codium"),isAntigravity:e.includes("antigravity")}}var _,M;function xe(n){let e=$e();console.log(`[Coolify] Running in: ${e.name}`);let t=S.env.remoteName!==void 0&&S.env.remoteName!=="",i=n.globalState.get("coolify.remoteAdvisoryShown");t&&!i&&S.window.showInformationMessage(`Coolify: You are in a remote session (${S.env.remoteName}). Make sure your Coolify server is reachable FROM this remote host.`,"Got it").then(()=>{n.globalState.update("coolify.remoteAdvisoryShown",!0)});let s=`coolify.greeted.${e.name}`;if(!n.globalState.get(s)){let c=e.isAntigravity?"Antigravity":e.isCursor?"Cursor":e.isTrae?"Trae":e.isWindsurf?"Windsurf":e.isVSCodium?"VSCodium":"VS Code";S.window.showInformationMessage(`\u{1F44B} Coolify Deployments is ready in ${c}! Sign in via the Accounts menu to get started.`,"Sign In","Dismiss").then(u=>{u==="Sign In"&&S.commands.executeCommand("coolify.login")}),n.globalState.update(s,!0)}let o=new U(n);_=new V(o);let r=S.window.createTreeView("coolify-deployments",{treeDataProvider:_,showCollapseAll:!0});M=new j(o),n.subscriptions.push(r,{dispose:()=>_?.dispose()},{dispose:()=>M?.dispose()});async function a(){let c=await o.isConfigured();await S.commands.executeCommand("setContext","coolify.isConfigured",c),c?(await _?.loadData(),await M?.initialize()):_?.refresh()}a().then(async()=>{_?.initialize(),await o.isConfigured()&&M?.initialize()}),n.subscriptions.push(S.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("coolify")&&a()})),fe(n,o,_,a);let l=new Y(n,o);n.subscriptions.push(l);let p=new z(l,o,a);n.subscriptions.push(S.window.registerUriHandler(p))}function Ee(){_?.dispose(),M?.dispose()}0&&(module.exports={activate,deactivate});
