"use strict";var Ee=Object.create;var V=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Re=Object.prototype.hasOwnProperty;var Ue=(s,e)=>{for(var t in e)V(s,t,{get:e[t],enumerable:!0})},re=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ne(e))!Re.call(s,n)&&n!==t&&V(s,n,{get:()=>e[n],enumerable:!(o=_e(e,n))||o.enumerable});return s};var v=(s,e,t)=>(t=s!=null?Ee(Me(s)):{},re(e||!s||!s.__esModule?V(t,"default",{value:s,enumerable:!0}):t,s)),Be=s=>re(V({},"__esModule",{value:!0}),s);var Oe={};Ue(Oe,{activate:()=>Xe,deactivate:()=>Ze});module.exports=Be(Oe);var k=v(require("vscode"));var K=v(require("vscode")),H=v(require("fs")),F=v(require("path")),B=v(require("os")),W=class s{constructor(e){this.context=e;e.globalState.setKeysForSync([s.SERVER_URL_KEY])}static SERVER_URL_KEY="coolify.serverUrl";static TOKEN_KEY="coolify.token";static TOKEN_FALLBACK_KEY="coolify.token.fallback";static SECRETS_SUPPORTED_KEY="coolify.secretsSupported";secretsAvailable;async getCliConfig(){try{let t=B.platform()==="win32"?F.join(process.env.APPDATA||F.join(B.homedir(),"AppData","Roaming"),"coolify","config.json"):F.join(B.homedir(),".config","coolify","config.json");if(H.existsSync(t)){let o=await H.promises.readFile(t,"utf-8"),n=JSON.parse(o),a=n.contexts?.default||n;if(a&&a.token&&a.host)return{url:a.host.replace(/\/$/,""),token:a.token}}}catch(e){console.warn("[Coolify] Failed to parse coolify-cli config.json:",e)}}async isConfigured(){let e=await this.getServerUrl(),t=await this.getToken();return!!e&&!!t}async getServerUrl(){let e=await this.getCliConfig();if(e?.url)return e.url;let t=K.workspace.getConfiguration("coolify").get("serverUrl");return t&&t.trim()!==""?t.trim():this.context.globalState.get(s.SERVER_URL_KEY)}async getToken(){let e=await this.getCliConfig();return e?.token?e.token:await this.hasSecretsSupport()?this.context.secrets.get(s.TOKEN_KEY):this.context.globalState.get(s.TOKEN_FALLBACK_KEY)}async setServerUrl(e){await this.context.globalState.update(s.SERVER_URL_KEY,e)}async setToken(e){await this.hasSecretsSupport()?await this.context.secrets.store(s.TOKEN_KEY,e):(await this.context.globalState.update(s.TOKEN_FALLBACK_KEY,e),K.window.showWarningMessage("Coolify: Your editor does not support secure secret storage. Your API token has been stored without encryption. Consider upgrading your editor or using a `.env` file."))}async clearConfiguration(){await this.context.globalState.update(s.SERVER_URL_KEY,void 0),await this.hasSecretsSupport()?await this.context.secrets.delete(s.TOKEN_KEY):await this.context.globalState.update(s.TOKEN_FALLBACK_KEY,void 0)}async hasSecretsSupport(){if(this.secretsAvailable!==void 0)return this.secretsAvailable;try{await this.context.secrets.get("__coolify_probe__"),this.secretsAvailable=!0}catch{this.secretsAvailable=!1,console.warn("[Coolify] SecretStorage not available in this editor \u2014 using plaintext fallback.")}return this.secretsAvailable}};var T=v(require("vscode")),le=v(require("child_process")),de=v(require("util"));var g=class{constructor(e,t){this.baseUrl=e;this.token=t}async fetchWithAuth(e,t){let o=new AbortController,n=setTimeout(()=>o.abort(),15e3);try{let a=await fetch(`${this.baseUrl}${e}`,{...t,headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json",...t?.headers||{}},signal:o.signal});if(!a.ok)throw new Error(`API request failed (${a.status}): ${a.statusText}`);return await a.json()}finally{clearTimeout(n)}}async fetchVoid(e,t="GET"){let o=new AbortController,n=setTimeout(()=>o.abort(),15e3);try{let a=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{Authorization:`Bearer ${this.token}`},signal:o.signal});if(!a.ok)throw new Error(`Request failed (${a.status}): ${a.statusText}`);return!0}finally{clearTimeout(n)}}async getApplications(){return this.fetchWithAuth("/api/v1/applications")}async getApplicationsByEnvironment(e,t){return(await this.fetchWithAuth(`/api/v1/projects/${e}/environment/${t}`)).applications??[]}async getApplicationLogs(e){let t=new AbortController,o=setTimeout(()=>t.abort(),15e3);try{let n=await fetch(`${this.baseUrl}/api/v1/applications/${e}/logs`,{headers:{Authorization:`Bearer ${this.token}`},signal:t.signal});if(!n.ok)throw new Error(`Failed to fetch logs: ${n.statusText}`);return await n.text()}finally{clearTimeout(o)}}async getApplication(e){return this.fetchWithAuth(`/api/v1/applications/${e}`)}async startApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/start`)}async stopApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/stop`)}async restartApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/restart`)}async getDeployments(){return this.fetchWithAuth("/api/v1/deployments")}async getApplicationDeployments(e){return this.fetchWithAuth(`/api/v1/applications/${e}/deployments`)}async startDeployment(e,t=!1){let o=t?"&force=true":"";return(await this.fetchWithAuth(`/api/v1/deploy?uuid=${e}${o}`)).deploy_uuid}async getDeployment(e){return this.fetchWithAuth(`/api/v1/deployments/${e}`)}async cancelDeployment(e){return this.fetchVoid(`/api/v1/deployments/${e}/cancel`,"POST")}async getProjects(){return this.fetchWithAuth("/api/v1/projects")}async getProjectEnvironments(e){return(await this.fetchWithAuth(`/api/v1/projects/${e}`)).environments??[]}async getServers(){return this.fetchWithAuth("/api/v1/servers")}async getDatabases(){return this.fetchWithAuth("/api/v1/databases")}async startDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/start`)}async stopDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/stop`)}async createDatabaseBackup(e){return this.fetchVoid(`/api/v1/databases/${e}/backup`,"POST")}async verifyToken(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/v1/version`,{headers:{Authorization:`Bearer ${this.token}`},signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async testConnection(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/health`,{signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async getVersion(){let e=await this.fetchWithAuth("/api/v1/version");return typeof e=="string"?e:e.version??"unknown"}};var je=de.promisify(le.exec);function ce(s){if(!s)return null;let e=s.trim().replace(/\.git$/,""),t=e.match(/[:/]([^/]+\/[^/]+)$/);return t&&t[1]?t[1].toLowerCase():e.toLowerCase()}var G=class{constructor(e){this.configManager=e}items=new Map;pollInterval;isDisposed=!1;isRefreshing=!1;cachedRemotes=null;matchedApps=[];getMatchedApps(){return this.matchedApps}async getWorkspaceGitRemotes(){if(this.cachedRemotes)return this.cachedRemotes;let e=new Set,t=T.workspace.workspaceFolders;if(!t)return e;for(let o of t)try{let{stdout:n}=await je("git config --get remote.origin.url",{cwd:o.uri.fsPath}),a=ce(n);a&&e.add(a)}catch{}return this.cachedRemotes=e,e}async initialize(){await this.refreshStatusBar(),this.startPolling()}startPolling(){if(this.pollInterval)return;let e=T.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.pollInterval=setInterval(()=>{this.isDisposed||this.refreshStatusBar().catch(console.error)},e)}async refreshStatusBar(){if(!(this.isDisposed||this.isRefreshing)){this.isRefreshing=!0;try{if(!await this.configManager.isConfigured()){this.clearItems();return}let t=await this.configManager.getServerUrl(),o=await this.configManager.getToken();if(!t||!o)return;let a=await new g(t,o).getApplications(),i=T.workspace.getConfiguration("coolify").get("defaultApplication"),r=[];if(i)r=a.filter(l=>l.id===i||l.uuid===i);else{let l=await this.getWorkspaceGitRemotes();l.size>0&&(r=a.filter(p=>{let d=ce(p.git_repository);return d&&l.has(d)}))}this.matchedApps=r;let c=r.filter(l=>l.status&&l.status.toLowerCase()!=="unknown"),f=new Set;for(let l of c){let p=l.uuid||l.id;if(!p)continue;f.add(p);let d=this.items.get(p);d||(d=T.window.createStatusBarItem(T.StatusBarAlignment.Left,100),this.items.set(p,d)),d.name=`Coolify \u2014 ${l.name}`;let D=this.getStatusIcon(l.status);d.text=`${D} ${l.name}: ${this.formatStatus(l.status)}`,d.tooltip=new T.MarkdownString(`**Coolify App: ${l.name}**

Status: \`${l.status}\`

Click to view logs`),d.command={title:"View Logs",command:"coolify.viewApplicationLogs",arguments:[{id:p,name:l.name}]},this.applyStatusBackground(d,l.status),d.show()}for(let[l,p]of this.items.entries())f.has(l)||(p.dispose(),this.items.delete(l))}catch(e){console.error("StatusBarManager: Failed to refresh:",e)}finally{this.isRefreshing=!1}}}getStatusIcon(e){let t=e?.toLowerCase()||"";return t.includes("running")?"$(vm-running)":t.includes("stopped")||t.includes("exited")?"$(vm-outline)":t.includes("deploying")||t.includes("starting")?"$(loading~spin)":t.includes("error")||t.includes("failed")?"$(error)":"$(circle-outline)"}formatStatus(e){let t=e?.toLowerCase()||"";return!t||t==="unknown"?"Unknown":t.includes("running")?"Running":t.includes("stopped")||t.includes("exited")?"Stopped":t.includes("deploying")||t.includes("starting")?"Deploying":t.includes("error")||t.includes("failed")?"Error":e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}applyStatusBackground(e,t){let o=t?.toLowerCase()||"";o.includes("error")||o.includes("failed")?e.backgroundColor=new T.ThemeColor("statusBarItem.errorBackground"):o.includes("deploying")||o.includes("starting")?e.backgroundColor=new T.ThemeColor("statusBarItem.warningBackground"):e.backgroundColor=void 0}clearItems(){for(let e of this.items.values())e.dispose();this.items.clear()}dispose(){this.isDisposed=!0,this.pollInterval&&clearInterval(this.pollInterval),this.clearItems()}};var u=v(require("vscode"));var b=class extends u.TreeItem{constructor(t,o,n,a,i){super(t,o);this.kind=n;this.rawData=a;this.parentId=i;this.applyKindConfig()}applyKindConfig(){switch(this.kind){case"project":this.iconPath=new u.ThemeIcon("folder"),this.contextValue="coolifyProject";break;case"environment":this.iconPath=new u.ThemeIcon("layers"),this.contextValue="coolifyEnvironment";break;case"application":{let t=this.rawData;this.iconPath=this.getAppIcon(t?.status),this.contextValue=`coolifyApp_${t?.status?.toLowerCase()??"unknown"}`,t?.fqdn&&(this.description=t.fqdn.replace(/^https?:\/\//,"")),this.tooltip=this.buildAppTooltip(t);break}case"server":{let t=this.rawData,o=t?.settings?.is_reachable;this.iconPath=new u.ThemeIcon(o?"server-process":"server-environment"),this.contextValue="coolifyServer",this.description=t?.ip;break}case"database":{let t=this.rawData;this.iconPath=new u.ThemeIcon("database"),this.contextValue=`coolifyDatabase_${t?.status?.toLowerCase()??"unknown"}`,this.description=t?.type;break}case"category":this.iconPath=new u.ThemeIcon("list-unordered"),this.contextValue="coolifyCategory";break;case"loading":this.iconPath=new u.ThemeIcon("loading~spin"),this.contextValue="coolifyLoading";break;case"empty":this.iconPath=new u.ThemeIcon("info"),this.contextValue="coolifyEmpty";break}}getAppIcon(t){switch(t?.toLowerCase()){case"running":return new u.ThemeIcon("vm-running",new u.ThemeColor("charts.green"));case"stopped":case"exited":return new u.ThemeIcon("vm-outline",new u.ThemeColor("charts.gray"));case"deploying":case"starting":return new u.ThemeIcon("sync~spin",new u.ThemeColor("charts.yellow"));case"error":case"failed":return new u.ThemeIcon("error",new u.ThemeColor("charts.red"));default:return new u.ThemeIcon("circle-outline")}}buildAppTooltip(t){if(!t)return new u.MarkdownString("No application data");let o=[`**${t.name}**`,"",`Status: \`${t.status??"unknown"}\``];return t.git_repository&&o.push(`Repo: \`${t.git_repository}\``),t.git_branch&&o.push(`Branch: \`${t.git_branch}\``),t.fqdn&&o.push(`URL: [${t.fqdn}](${t.fqdn})`),new u.MarkdownString(o.join(`
`))}},Y=class{constructor(e){this.configManager=e}_onDidChangeTreeData=new u.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refreshInterval;isDisposed=!1;service;cachedProjects=[];cachedApplications=[];cachedServers=[];cachedDatabases=[];isConfigured=!1;async initialize(){await this.loadData(),this.startAutoRefresh()}startAutoRefresh(){let e=u.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.refreshInterval=setInterval(()=>{this.isDisposed||this.loadData().catch(console.error)},e)}async getService(){let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();return!e||!t?null:(this.service=new g(e,t),this.service)}async loadData(){if(this.isConfigured=await this.configManager.isConfigured(),!this.isConfigured){this.refresh();return}try{let e=await this.getService();if(!e)return;let[t,o,n,a]=await Promise.allSettled([e.getProjects(),e.getApplications(),e.getServers(),e.getDatabases()]);this.cachedProjects=t.status==="fulfilled"?t.value:[],this.cachedApplications=o.status==="fulfilled"?o.value:[],this.cachedServers=n.status==="fulfilled"?n.value:[],this.cachedDatabases=a.status==="fulfilled"?a.value:[],this.refresh()}catch(e){console.error("CoolifyTreeDataProvider: Failed to load data:",e)}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!this.isConfigured){let t=new b("Not signed in \u2014 click to connect",u.TreeItemCollapsibleState.None,"empty");return t.command={command:"coolify.login",title:"Sign In"},[t]}if(!e)return[new b("Projects",u.TreeItemCollapsibleState.Expanded,"category"),new b("Applications",u.TreeItemCollapsibleState.Collapsed,"category"),new b("Servers",u.TreeItemCollapsibleState.Collapsed,"category"),new b("Databases",u.TreeItemCollapsibleState.Collapsed,"category")];if(e.kind==="category")return this.getCategoryChildren(e.label);if(e.kind==="project"){let t=e.rawData;return!t.environments||t.environments.length===0?[new b("No environments",u.TreeItemCollapsibleState.None,"empty")]:t.environments.map(o=>new b(o.name,u.TreeItemCollapsibleState.Collapsed,"environment",o,String(t.uuid)))}if(e.kind==="environment"){let t=e.rawData,o=this.cachedApplications.filter(n=>t.applications?t.applications.some(a=>a.id===n.id):!0);return o.length===0?[new b("No applications",u.TreeItemCollapsibleState.None,"empty")]:o.map(n=>new b(n.name,u.TreeItemCollapsibleState.None,"application",n))}return[]}getCategoryChildren(e){switch(e){case"Projects":return this.cachedProjects.length===0?[new b("No projects found",u.TreeItemCollapsibleState.None,"empty")]:this.cachedProjects.map(t=>new b(t.name,u.TreeItemCollapsibleState.Collapsed,"project",t));case"Applications":return this.cachedApplications.length===0?[new b("No applications found",u.TreeItemCollapsibleState.None,"empty")]:this.cachedApplications.map(t=>new b(t.name,u.TreeItemCollapsibleState.None,"application",t));case"Servers":return this.cachedServers.length===0?[new b("No servers found",u.TreeItemCollapsibleState.None,"empty")]:this.cachedServers.map(t=>new b(t.name,u.TreeItemCollapsibleState.None,"server",t));case"Databases":return this.cachedDatabases.length===0?[new b("No databases found",u.TreeItemCollapsibleState.None,"empty")]:this.cachedDatabases.map(t=>new b(t.name,u.TreeItemCollapsibleState.None,"database",t));default:return[]}}getService_(){return this.service}getCachedApplications(){return this.cachedApplications}getCachedDatabases(){return this.cachedDatabases}dispose(){this.isDisposed=!0,this.refreshInterval&&clearInterval(this.refreshInterval),this._onDidChangeTreeData.dispose()}};var C=v(require("vscode"));var m=v(require("vscode"));var pe=require("child_process"),z=require("child_process"),oe;function qe(){return oe||(oe=m.window.createOutputChannel("Coolify: Deploy Pipeline")),oe}function M(s,e){s.appendLine(""),s.appendLine(`${"\u2500".repeat(60)}`),s.appendLine(`  ${e}`),s.appendLine(`${"\u2500".repeat(60)}`)}function h(){return new Date().toLocaleTimeString()}async function Ve(s,e){M(e,"\u{1F500}  STAGE 1 \u2014 Git Push");try{e.appendLine(`[${h()}] Attempting precise push via VS Code Git Extension...`);let o=m.extensions.getExtension("vscode.git")?.exports?.getAPI(1);if(o){let n=o.repositories.find(a=>a.rootUri.fsPath===s);if(n)return await n.push("origin","HEAD"),e.appendLine(`[${h()}] \u2705 Git push succeeded (via VS Code API).`),!0;e.appendLine(`[${h()}] \u26A0\uFE0F Repository not managed by VS Code Git API. Falling back to terminal...`)}else e.appendLine(`[${h()}] \u26A0\uFE0F Git Extension unavailable. Falling back to terminal...`)}catch(t){e.appendLine(`[${h()}] \u274C VS Code Git push encountered an error: ${t instanceof Error?t.message:String(t)}`),e.appendLine(`[${h()}] Falling back to terminal process...`)}return new Promise(t=>{e.appendLine(`[${h()}] Running fallback: git push origin HEAD`);let o=(0,pe.spawn)("git",["push","origin","HEAD"],{cwd:s});o.stdout.on("data",n=>{e.append(n.toString())}),o.stderr.on("data",n=>{e.append(n.toString())}),o.on("close",n=>{n===0?(e.appendLine(`[${h()}] \u2705 Git push succeeded.`),t(!0)):(e.appendLine(`[${h()}] \u274C Git push exited with code ${n}.`),t(!1))}),o.on("error",n=>{e.appendLine(`[${h()}] \u274C Git push error: ${n.message}`),t(!1)})})}async function Fe(s,e,t,o){M(o,"\u2705  STAGE 2 \u2014 Commit Verification"),o.appendLine(`[${h()}] Waiting for Coolify to detect commit: ${t.slice(0,8)}`);let n=20;for(let a=0;a<n;a++){try{let r=(await s.getApplication(e)).git_commit_sha;if(o.appendLine(`[${h()}] Attempt ${a+1}/${n} \u2014 Coolify SHA: ${r?.slice(0,8)??"unknown"}`),r&&t.startsWith(r)||r&&r.startsWith(t.slice(0,8))){o.appendLine(`[${h()}] \u2705 Commit verified on Coolify!`);return}}catch(i){o.appendLine(`[${h()}] (poll error: ${i instanceof Error?i.message:String(i)})`)}await new Promise(i=>setTimeout(i,3e3))}o.appendLine(`[${h()}] \u26A0\uFE0F  Commit not yet visible on Coolify \u2014 continuing anyway (webhook may handle it).`)}async function We(s,e,t,o,n,a=!1){M(o,"\u{1F680}  STAGE 3 \u2014 Triggering Deployment");let i;try{i=await s.startDeployment(e,a)}catch(l){return o.appendLine(`[${h()}] \u274C Failed to start deployment: ${l instanceof Error?l.message:String(l)}`),!1}if(!i)return o.appendLine(`[${h()}] \u26A0\uFE0F  Deployment started but no UUID returned \u2014 cannot stream logs.`),m.window.showInformationMessage(`\u{1F680} Deployment started for ${t}`),!0;o.appendLine(`[${h()}] Deploy UUID: ${i}`),M(o,"\u{1F4CB}  STAGE 4 \u2014 Live Deploy Logs"),o.appendLine(`[${h()}] Polling for build logs...`);let r=0,c=!1,f=!1;for(;!c&&!n.isCancellationRequested;){await new Promise(l=>setTimeout(l,3e3));try{let l=await s.getDeployment(i);if(!l)continue;if(l.logs&&typeof l.logs=="string"){let d=l.logs;d.length>r&&(o.append(d.substring(r)),r=d.length)}let p=l.status??"";if(p==="finished"||p==="failed"||p==="error"){c=!0,f=p==="finished";let d=f?"\u2705":"\u274C";o.appendLine(`
[${h()}] ${d} Deployment ${p.toUpperCase()}.`),f?m.window.showInformationMessage(`\u2705 Deployment successful: ${t}`):m.window.showErrorMessage(`\u274C Deployment failed: ${t} (${p})`)}}catch(l){o.appendLine(`[${h()}] (log poll error: ${l instanceof Error?l.message:String(l)})`)}}return f}async function Ke(s,e,t,o,n){M(o,"\u{1F4E1}  STAGE 5 \u2014 Live App Logs"),o.appendLine(`[${h()}] Tailing app logs for ${t}\u2026 (cancel the progress notification to stop)`);let a=0;for(;!n.isCancellationRequested;){try{let i=await s.getApplicationLogs(e);i&&i.length>a&&(o.append(i.substring(a)),a=i.length)}catch(i){o.appendLine(`[${h()}] (app log fetch error: ${i instanceof Error?i.message:String(i)})`)}await new Promise(i=>setTimeout(i,3e3))}o.appendLine(`
[${h()}] \u{1F6D1} App log tailing stopped.`)}async function E(s,e,t="Application",o=!1){try{let n=await s.getServerUrl(),a=await s.getToken();if(!n||!a)throw new Error("Coolify is not configured. Please sign in.");let i=new g(n,a),r=qe();r.clear(),r.show(!0),r.appendLine(`\u2554${"\u2550".repeat(58)}\u2557`),r.appendLine(`\u2551  Coolify Deploy Pipeline \u2014 ${t.padEnd(28)} \u2551`),r.appendLine(`\u2551  Started: ${h().padEnd(46)} \u2551`),r.appendLine(`\u255A${"\u2550".repeat(58)}\u255D`);let c,f=m.workspace.workspaceFolders;if(f&&f.length>0){let l=f[0].uri.fsPath;try{if((0,z.execSync)("git status --porcelain",{cwd:l}).toString().trim().length>0&&await m.window.showWarningMessage("You have uncommitted changes. Only committed files will be pushed to Coolify. Proceed anyway?","Proceed","Cancel")!=="Proceed"){r.appendLine(`[${h()}] \u{1F6D1} Deployment cancelled by user (uncommitted changes).`);return}}catch{r.appendLine(`[${h()}] \u26A0\uFE0F Could not check git status.`)}try{let d=(0,z.execSync)("git rev-parse --abbrev-ref HEAD",{cwd:l}).toString().trim(),$=(await i.getApplication(e))?.git_branch;if($&&d!==$&&await m.window.showWarningMessage(`Coolify expects branch '${$}', but your local branch is '${d}'. Your push might not trigger the correct deployment. Proceed anyway?`,"Proceed","Cancel")!=="Proceed"){r.appendLine(`[${h()}] \u{1F6D1} Deployment cancelled by user (branch mismatch).`);return}}catch(d){r.appendLine(`[${h()}] \u26A0\uFE0F Could not verify git branch match: ${d instanceof Error?d.message:String(d)}`)}try{c=(0,z.execSync)("git rev-parse HEAD",{cwd:l}).toString().trim()}catch{r.appendLine(`[${h()}] \u26A0\uFE0F  Could not read local git SHA.`)}if(!await m.window.withProgress({location:m.ProgressLocation.Notification,title:`[Coolify] ${t}: Pushing to GitHub\u2026`,cancellable:!1},()=>Ve(l,r))){m.window.showErrorMessage(`\u274C Git push failed for ${t}. Check the Coolify Deploy Pipeline output for details.`),r.show(!0);return}c&&await m.window.withProgress({location:m.ProgressLocation.Notification,title:`[Coolify] ${t}: Verifying commit on Coolify\u2026`,cancellable:!1},()=>Fe(i,e,c,r))}else M(r,"\u{1F500}  STAGE 1 \u2014 Git Push"),r.appendLine(`[${h()}] \u23ED  No workspace open \u2014 skipping git push.`),M(r,"\u2705  STAGE 2 \u2014 Commit Verification"),r.appendLine(`[${h()}] \u23ED  Skipped (no workspace).`);await m.window.withProgress({location:m.ProgressLocation.Notification,title:`[Coolify] ${t}: Deploying\u2026`,cancellable:!0},async(l,p)=>{await We(i,e,t,r,p,o)&&await Ke(i,e,t,r,p)})}catch(n){m.window.showErrorMessage(`Deploy pipeline error: ${n instanceof Error?n.message:"Unknown error"}`)}}async function ue(s,e){try{let t=e.getMatchedApps();if(!t||t.length===0){m.window.showInformationMessage("No Coolify apps found matching the current workspace.");return}if(t.length===1){let n=t[0];await E(s,n.uuid||n.id||"",n.name);return}let o=await m.window.showQuickPick(t.map(n=>({label:n.name,description:n.status,detail:n.fqdn?`\u{1F310} ${n.fqdn}`:void 0,id:n.uuid||n.id||""})),{placeHolder:"Select an application to deploy from current workspace",title:"Coolify: Deploy Current Project"});o&&await E(s,o.id,o.label)}catch(t){m.window.showErrorMessage(t instanceof Error?t.message:"Failed to start deployment")}}async function fe(s){try{let e=await s.getServerUrl(),t=await s.getToken();if(!e||!t)throw new Error("Extension not configured properly");let o=new g(e,t),a=(await o.getDeployments()).filter(r=>r.status==="in_progress"||r.status==="queued");if(!a||a.length===0){m.window.showInformationMessage("No active deployments found");return}let i=await m.window.showQuickPick(a.map(r=>({label:`Cancel: ${r.application_name||"Deployment"}`,description:r.status,detail:r.commit_message||`Deployment ID: ${r.id}`,id:r.id})),{placeHolder:"Select a deployment to cancel",title:"Cancel Deployment"});i&&m.window.withProgress({location:m.ProgressLocation.Notification,title:`Canceling ${i.label}\u2026`,cancellable:!1},async()=>{await o.cancelDeployment(i.id),m.window.showInformationMessage("\u2705 Deployment canceled.")})}catch(e){m.window.showErrorMessage(e instanceof Error?e.message:"Failed to cancel deployment")}}async function ge(s,e){try{let t=await s.getServerUrl(),o=await s.getToken();if(!t||!o)throw new Error("Not configured");let a=await new g(t,o).getApplications();if(!a||a.length===0){m.window.showInformationMessage("No applications found");return}let i=await m.window.showQuickPick(a.map(r=>({label:r.name,description:r.status,detail:r.fqdn?`\u{1F310} ${r.fqdn}`:void 0,id:r.uuid||r.id||""})),{placeHolder:"Select an application to FORCE deploy (no cache)",title:"Coolify: Force Deploy"});i&&await E(s,i.id,i.label,!0)}catch(t){m.window.showErrorMessage(t instanceof Error?t.message:"Failed to start force deployment")}}var L=v(require("vscode"));async function ie(s,e,t,o,n){try{let a=await s.getServerUrl(),i=await s.getToken();if(!a||!i)throw new Error("Extension not configured properly");let r=new g(a,i),c=o,f=n;if(!c){let l=await r.getApplications();if(!l||l.length===0){L.window.showInformationMessage("No applications found");return}let p=await L.window.showQuickPick(l.map(d=>({label:d.name,description:d.status,detail:`Status: ${d.status}`,id:d.uuid||d.id||""})),{placeHolder:`Select an application to ${e}`,title:t});if(!p)return;c=p.id,f=p.label}await L.window.withProgress({location:L.ProgressLocation.Notification,title:`${e}ing ${f}...`,cancellable:!1},async()=>{e==="start"?await r.startApplication(c):e==="stop"?await r.stopApplication(c):await r.restartApplication(c),L.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&L.window.showInformationMessage(`\u2705 Successfully ${e}ed ${f}`)})}catch(a){L.window.showErrorMessage(a instanceof Error?a.message:`Failed to ${e} application`)}}async function he(s,e,t,o){await ie(e,"start","Start Application",t,o)}async function me(s,e,t,o){await ie(e,"stop","Stop Application",t,o)}async function we(s,e,t,o){await ie(e,"restart","Restart Application",t,o)}var P=v(require("vscode"));async function ve(s,e,t,o,n){let a=o,i=n||"Database";if(!a){let l=await s.getServerUrl(),p=await s.getToken();if(!l||!p){P.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let d=new g(l,p),D=[];if(await P.window.withProgress({location:P.ProgressLocation.Notification,title:"Fetching databases..."},async()=>{D=await d.getDatabases()}),!D||D.length===0){P.window.showInformationMessage("No databases found.");return}let $=await P.window.showQuickPick(D.map(S=>({label:S.name,description:S.status,detail:S.type,id:S.uuid})),{placeHolder:`Select a database to ${e}`,title:t});if(!$)return;a=$.id,i=$.label}if(!a)return;let r=await s.getServerUrl(),c=await s.getToken();if(!r||!c){P.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let f=new g(r,c);await P.window.withProgress({location:P.ProgressLocation.Notification,title:`${t} for ${i}...`,cancellable:!1},async()=>{try{e==="start"?await f.startDatabase(a):e==="stop"&&await f.stopDatabase(a),P.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&P.window.showInformationMessage(`\u2705 ${i} ${e} command sent successfully`)}catch(l){P.window.showErrorMessage(`Failed to ${e} ${i}`),console.error(`Error in database action (${e}):`,l)}})}async function Q(s,e,t,o){await ve(e,"start","Start Database",t,o)}async function J(s,e,t,o){await ve(e,"stop","Stop Database",t,o)}var y=v(require("vscode"));var ne=v(require("vscode")),ye=require("child_process"),be=require("util"),He=(0,be.promisify)(ye.exec);async function Ce(){try{return await He("coolify --version"),!0}catch{return!1}}async function Se(s,e="Coolify CLI"){let o=ne.window.terminals.find(n=>n.name===e)||ne.window.createTerminal(e);o.show(),o.sendText(`coolify ${s}`)}var se;function Ae(){return se||(se=y.window.createOutputChannel("Coolify Logs")),se}async function j(s,e){try{let t=await s.getServerUrl(),o=await s.getToken();if(!t||!o)throw new Error("Extension not configured properly");let n=new g(t,o),a=e?.id,i=e?.name;if(!a){let c=await n.getApplications();if(!c||c.length===0){y.window.showInformationMessage("No applications found");return}let f=await y.window.showQuickPick(c.map(l=>({label:l.name,description:l.status,detail:l.fqdn,id:l.uuid||l.id||""})),{placeHolder:"Select an application to view logs",title:"Coolify: View Logs"});if(!f)return;a=f.id,i=f.label}let r=Ae();r.clear(),r.show(!0),r.appendLine(`\u2500\u2500 Coolify Logs \u2014 ${i} \u2500\u2500`),r.appendLine(`Fetching logs from ${t}...`),r.appendLine(""),await y.window.withProgress({location:y.ProgressLocation.Notification,title:`Fetching logs for ${i}...`,cancellable:!1},async()=>{let c=await n.getApplicationLogs(a);r.appendLine(c||"(No log output)")})}catch(t){y.window.showErrorMessage(t instanceof Error?t.message:"Failed to fetch logs")}}async function q(s,e){try{let t=await s.getServerUrl(),o=await s.getToken();if(!t||!o)throw new Error("Extension not configured properly");let n=new g(t,o),a=e?.id,i=e?.name;if(!a){let f=await n.getApplications();if(!f||f.length===0){y.window.showInformationMessage("No applications found");return}let l=await y.window.showQuickPick(f.map(p=>({label:p.name,description:p.status,detail:p.fqdn,id:p.uuid||p.id||""})),{placeHolder:"Select an application to tail logs",title:"Coolify: Live App Logs"});if(!l)return;a=l.id,i=l.label}let r=a;if(await Ce()){y.window.showInformationMessage(`Opening live logs for ${i} via Coolify CLI...`),await Se(`logs tail ${r}`,`Logs: ${i}`);return}let c=Ae();c.clear(),c.show(!0),c.appendLine(`\u2500\u2500 Coolify Live Logs \u2014 ${i} \u2500\u2500`),c.appendLine("Tailing logs\u2026 (cancel the progress notification to stop)"),c.appendLine(""),await y.window.withProgress({location:y.ProgressLocation.Notification,title:`[Coolify] Live logs: ${i}`,cancellable:!0},async(f,l)=>{let p=0;for(;!l.isCancellationRequested;){try{let d=await n.getApplicationLogs(a);d&&d.length>p&&(c.append(d.substring(p)),p=d.length)}catch(d){c.appendLine(`(fetch error: ${d instanceof Error?d.message:String(d)})`)}await new Promise(d=>setTimeout(d,3e3))}c.appendLine(`
\u{1F6D1} Live log tail stopped.`)})}catch(t){y.window.showErrorMessage(t instanceof Error?t.message:"Failed to tail logs")}}async function X(s,e){try{let t=await s.getServerUrl(),o=await s.getToken();if(!t||!o)throw new Error("Extension not configured properly");let n=new g(t,o),a=e?.id,i=e?.name;if(!a){let r=await n.getDatabases();if(!r||r.length===0){y.window.showInformationMessage("No databases found");return}let c=await y.window.showQuickPick(r.map(f=>({label:f.name,description:f.type,detail:f.status,id:f.uuid})),{placeHolder:"Select a database to back up",title:"Coolify: Create Database Backup"});if(!c)return;a=c.id,i=c.label}await y.window.withProgress({location:y.ProgressLocation.Notification,title:`Creating backup for ${i}...`,cancellable:!1},async()=>{await n.createDatabaseBackup(a),y.window.showInformationMessage(`\u2705 Backup created for ${i}`)})}catch(t){y.window.showErrorMessage(t instanceof Error?t.message:"Failed to create backup")}}var w=v(require("vscode"));async function ke(s,e,t){let o,n="";if(t?.kind==="application"&&t.rawData){let i=t.rawData;o=i.fqdn,n=i.name}else{let i=e.getCachedApplications().filter(c=>!!c.fqdn);if(i.length===0){w.window.showInformationMessage("No applications have a public URL configured in Coolify.");return}let r=await w.window.showQuickPick(i.map(c=>({label:c.name,description:c.fqdn.replace(/^https?:\/\//,""),detail:`Status: ${c.status??"unknown"}`,fqdn:c.fqdn})),{placeHolder:"Select an application to open",title:"Open in Browser"});if(!r)return;o=r.fqdn,n=r.label}if(!o){w.window.showWarningMessage(`${n} has no public URL configured in Coolify.`);return}let a=w.Uri.parse(o.startsWith("http")?o:`https://${o}`);await w.env.openExternal(a)}async function De(s,e){let t,o="";if(e?.rawData){let n=e.rawData;t=n.uuid??n.uuid,o=n.name??n.name}else{let n=s.getCachedApplications(),a=s.getCachedDatabases(),i=[...n.map(c=>({label:c.name,description:`App \xB7 ${c.uuid}`,uuid:c.uuid})),...a.map(c=>({label:c.name,description:`DB \xB7 ${c.uuid}`,uuid:c.uuid}))];if(i.length===0){w.window.showInformationMessage("No resources found to copy UUID from.");return}let r=await w.window.showQuickPick(i,{placeHolder:"Select a resource to copy its UUID",title:"Copy UUID"});if(!r)return;t=r.uuid,o=r.label}if(!t){w.window.showWarningMessage("UUID not available for this resource.");return}await w.env.clipboard.writeText(t),w.window.showInformationMessage(`\u2705 UUID for "${o}" copied to clipboard!`)}async function $e(s,e){let t=e.getCachedApplications();if(t.length===0){w.window.showInformationMessage("No applications found. Try refreshing.");return}let o=c=>{switch(c?.toLowerCase()){case"running":return"\u{1F7E2}";case"stopped":case"exited":return"\u{1F534}";case"deploying":case"starting":return"\u{1F7E1}";case"error":case"failed":return"\u274C";default:return"\u26AA"}},n=await w.window.showQuickPick(t.map(c=>({label:`${o(c.status)} ${c.name}`,description:c.fqdn?.replace(/^https?:\/\//,"")??"",detail:`Status: ${c.status??"unknown"} \xB7 ${c.git_branch?`Branch: ${c.git_branch}`:""}`,uuid:c.uuid??c.id??"",name:c.name})),{placeHolder:"Type to filter, select to deploy immediately",title:"\u26A1 Quick Deploy",matchOnDescription:!0,matchOnDetail:!0});if(!n)return;let a=await s.getServerUrl(),i=await s.getToken();if(!a||!i){w.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let r=new g(a,i);await w.window.withProgress({location:w.ProgressLocation.Notification,title:`\u{1F680} Deploying ${n.name}\u2026`,cancellable:!1},async()=>{try{await r.startDeployment(n.uuid),w.window.showInformationMessage(`\u{1F680} ${n.name} deployment started!`,"View Logs").then(c=>{c==="View Logs"&&w.commands.executeCommand("coolify.viewApplicationLogs",{id:n.uuid,name:n.name})})}catch(c){w.window.showErrorMessage(`Deploy failed: ${c instanceof Error?c.message:String(c)}`)}})}async function Pe(s){let e=await s.getServerUrl(),t=await s.getToken();if(!e||!t){w.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}await w.window.withProgress({location:w.ProgressLocation.Notification,title:"Testing Coolify connection\u2026",cancellable:!1},async()=>{try{let n=await new g(e,t).getVersion();w.window.showInformationMessage(`\u2705 Connected to Coolify v${n} at ${e.replace(/^https?:\/\//,"")}`)}catch(o){w.window.showErrorMessage(`\u274C Connection failed: ${o instanceof Error?o.message:String(o)}`)}})}var x=v(require("vscode"));function Ge(s,e){if(!e||!s)return!1;let t=e.replace(/\.git$/,"").toLowerCase();for(let o of s){let n=o.fetchUrl?o.fetchUrl.replace(/\.git$/,"").toLowerCase():"",a=o.pushUrl?o.pushUrl.replace(/\.git$/,"").toLowerCase():"";if(n.endsWith(t)||a.endsWith(t))return!0}return!1}function Te(s,e,t){let o=x.extensions.getExtension("vscode.git");if(!o)return;let n=o.isActive?o.exports:null;if(!n)return;let a=n.getAPI(1);if(a?.repositories?.length)for(let i of a.repositories)s.subscriptions.push(i.state.onDidChange(async()=>{let r=i.state.HEAD?.name;if(!r||!await e.isConfigured())return;let f=t.getCachedApplications().filter(d=>d.git_branch===r&&d.status!=="deploying"&&Ge(i.state.remotes,d.git_repository));if(f.length===0)return;let l=`coolify.gitAdvisor.${r}`,p=s.globalState.get(l)??0;if(!(Date.now()-p<3e4))if(await s.globalState.update(l,Date.now()),f.length===1){let d=f[0];await x.window.showInformationMessage(`Coolify: "${d.name}" is configured to deploy from \`${r}\`. Deploy now?`,"Deploy","Dismiss")==="Deploy"&&x.commands.executeCommand("coolify.startDeployment",{kind:"application",rawData:d})}else{let d=await e.getServerUrl(),D=await e.getToken();if(!d||!D)return;let $=await x.window.showQuickPick(f.map(S=>({label:S.name,description:S.fqdn??"",detail:`Branch: ${S.git_branch}`,uuid:S.uuid??S.id??""})),{title:`Deploy from ${r}?`,placeHolder:"Select an app to deploy (Escape to skip)"});if($){let S=new g(d,D);await x.window.withProgress({location:x.ProgressLocation.Notification,title:`\u{1F680} Deploying ${$.label}\u2026`,cancellable:!1},async()=>{await S.startDeployment($.uuid),x.window.showInformationMessage(`\u{1F680} ${$.label} deployment started!`)})}}}))}var A=v(require("vscode"));var Z=class s{constructor(e,t,o){this.configManager=o;this._panel=e,this._extensionUri=t,this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.onDidChangeViewState(n=>{this._panel.visible?this.startAutoRefresh():this.stopAutoRefresh()},null,this._disposables),this._panel.webview.onDidReceiveMessage(n=>{switch(n.type){case"refresh":this.updatePanelData();break;case"openLogs":A.commands.executeCommand("coolify.viewApplicationLogs",n.uuid,n.name);break;case"openLiveLogs":A.commands.executeCommand("coolify.viewApplicationLogsLive",n.uuid,n.name);break;case"deployApp":A.commands.executeCommand("coolify.startDeployment",n.uuid);break}},null,this._disposables),this.startAutoRefresh()}static currentPanel;_panel;_extensionUri;_disposables=[];_refreshInterval;static createOrShow(e,t){let o=A.window.activeTextEditor?A.window.activeTextEditor.viewColumn:void 0;if(s.currentPanel){s.currentPanel._panel.reveal(o);return}let n=A.window.createWebviewPanel("coolifyDashboard","Coolify Dashboard",o||A.ViewColumn.One,{enableScripts:!0,localResourceRoots:[A.Uri.joinPath(e,"public")]});s.currentPanel=new s(n,e,t)}startAutoRefresh(){this.stopAutoRefresh(),this.updatePanelData();let e=A.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this._refreshInterval=setInterval(()=>this.updatePanelData(),e)}stopAutoRefresh(){this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=void 0)}async updatePanelData(){if(this._panel.visible)try{let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();if(!e||!t){this._panel.webview.html=this.getNotConfiguredHtml();return}let o=new g(e,t),[n,a,i]=await Promise.all([o.getServers(),o.getApplications(),o.getDatabases()]);this._panel.webview.html=this.getDashboardHtml(n,a,i,e)}catch(e){console.error("Coolify Dashboard error:",e),this._panel.webview.html=`<h1>Error Loading Dashboard</h1><p>${e instanceof Error?e.message:"Unknown error"}</p>`}}getNotConfiguredHtml(){return`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <style>
                    body { display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
                    .container { text-align: center; }
                    button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; border-radius: 4px; }
                    button:hover { background: var(--vscode-button-hoverBackground); }
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>Welcome to Coolify Deployments</h1>
                    <p>Connect your Coolify server to view your dashboard.</p>
                </div>
            </body>
            </html>
        `}getDashboardHtml(e,t,o,n){let a=this._panel.webview.asWebviewUri(A.Uri.joinPath(this._extensionUri,"public","logo.svg")),i=e.map(l=>`
            <div class="card">
                <div class="card-header">
                    <h3>\u{1F5A5}\uFE0F ${l.name}</h3>
                    <span class="badge ${l.settings?.is_reachable?"badge-success":"badge-danger"}">
                        ${l.settings?.is_reachable?"Online":"Unreachable"}
                    </span>
                </div>
                <div class="card-body">
                    <p>IP: <code>${l.ip}</code></p>
                    <p>User: <code>${l.user}</code></p>
                </div>
            </div>
        `).join(""),r={running:"badge-success",deploying:"badge-warning",starting:"badge-warning",stopped:"badge-dark",exited:"badge-dark",error:"badge-danger",failed:"badge-danger"},c=t.map(l=>{let p=r[l.status?.toLowerCase()]||"badge-dark",d=l.name.length>20?l.name.substring(0,20)+"...":l.name,D=l.fqdn?`<a href="${l.fqdn}">${l.fqdn.replace("https://","").replace("http://","")}</a>`:"No URL",$=l.git_repository?`${l.git_repository}@${l.git_branch}`:"N/A",S=l.uuid||l.id,te=l.server_id?e.find(ae=>ae.id===l.server_id||Number(ae.id)===l.server_id):void 0,Le=te?`<span class="badge" title="Running on ${te.name}" style="background:#374151; font-size:9px; padding:2px 6px; font-weight:normal; margin-left:6px;">\u2601\uFE0F ${te.name}</span>`:"";return`
            <div class="card">
                <div class="card-header">
                    <div style="display:flex; flex-direction:column; align-items:flex-start;">
                        <h3 title="${l.name}">${d} ${Le}</h3>
                    </div>
                    <span class="badge ${p}">${l.status||"unknown"}</span>
                </div>
                <div class="card-body">
                    <p class="truncate" title="${l.fqdn||"No URL"}">\u{1F310} ${D}</p>
                    <p class="truncate" title="${l.git_repository}@${l.git_branch}">\u{1F4E6} ${$}</p>
                </div>
                <div class="card-footer">
                    <button class="icon-btn" onclick="openLogs('${S}', '${l.name}')" title="One-shot Logs">\u{1F4CB} Logs</button>
                    <button class="icon-btn" onclick="openLiveLogs('${S}', '${l.name}')" title="Live Tail Logs">\u{1F4E1} Live Logs</button>
                    <button class="icon-btn deploy-btn" onclick="deployApp('${S}')" title="Deploy">\u{1F680} Deploy</button>
                </div>
            </div>
        `}).join(""),f=o.map(l=>{let p=l.status?.toLowerCase()||"unknown",d=r[p]||"badge-dark";return`
            <div class="card">
                <div class="card-header">
                    <h3>\u{1F5C4}\uFE0F ${l.name}</h3>
                    <span class="badge ${d}">${l.status||"unknown"}</span>
                </div>
                <div class="card-body">
                    <p>Type: <code>${l.type}</code></p>
                </div>
            </div>
        `}).join("");return`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Coolify Dashboard</title>
                <style>
                    :root {
                        --bg: var(--vscode-editor-background);
                        --fg: var(--vscode-editor-foreground);
                        --card-bg: var(--vscode-editorWidget-background);
                        --card-border: var(--vscode-widget-border);
                        --btn-bg: var(--vscode-button-background);
                        --btn-fg: var(--vscode-button-foreground);
                        --btn-hover: var(--vscode-button-hoverBackground);
                        --link: var(--vscode-textLink-foreground);
                    }
                    body {
                        font-family: var(--vscode-font-family), sans-serif;
                        padding: 30px;
                        background-color: var(--bg);
                        color: var(--fg);
                        overflow-y: auto;
                    }
                    header {
                        display: flex;
                        align-items: center;
                        border-bottom: 1px solid var(--card-border);
                        padding-bottom: 20px;
                        margin-bottom: 30px;
                    }
                    header img { width: 48px; height: 48px; margin-right: 15px; }
                    header h1 { margin: 0; font-weight: 600; font-size: 24px; }
                    header .server-url { margin-left: auto; opacity: 0.6; font-family: monospace; }
                    
                    section { margin-bottom: 40px; }
                    section h2 { margin-bottom: 20px; font-size: 18px; font-weight: 500; border-bottom: 1px dashed var(--card-border); padding-bottom: 8px; display: inline-block; }
                    
                    .grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                        gap: 20px;
                    }
                    
                    .card {
                        background-color: var(--card-bg);
                        border: 1px solid var(--card-border);
                        border-radius: 8px;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                        display: flex;
                        flex-direction: column;
                        transition: transform 0.1s ease, box-shadow 0.1s ease;
                    }
                    .card:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
                    
                    .card-header {
                        padding: 15px;
                        border-bottom: 1px solid var(--card-border);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .card-header h3 { margin: 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
                    
                    .card-body { padding: 15px; flex-grow: 1; }
                    .card-body p { margin: 8px 0; font-size: 13px; opacity: 0.8; }
                    .truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
                    
                    .card-footer {
                        padding: 10px 15px;
                        background-color: rgba(0,0,0,0.1);
                        border-top: 1px solid var(--card-border);
                        display: flex;
                        gap: 10px;
                        justify-content: flex-end;
                    }
                    
                    .badge {
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 11px;
                        font-weight: bold;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    .badge-success { background: #10B981; color: white; }
                    .badge-danger { background: #EF4444; color: white; }
                    .badge-warning { background: #F59E0B; color: white; }
                    .badge-dark { background: #6B7280; color: white; }
                    
                    code {
                        background: rgba(128,128,128,0.2);
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-family: var(--vscode-editor-font-family);
                    }
                    a { color: var(--link); text-decoration: none; }
                    a:hover { text-decoration: underline; }
                    
                    button.icon-btn {
                        background: var(--btn-bg);
                        color: var(--btn-fg);
                        border: none;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                    }
                    button.icon-btn:hover { background: var(--btn-hover); }
                    button.deploy-btn { background: #3B82F6; }
                    button.deploy-btn:hover { background: #2563EB; }
                </style>
            </head>
            <body>
                <header>
                    <img src="${a}" alt="Coolify" />
                    <h1>Coolify Infrastructure</h1>
                    <div class="server-url">${n}</div>
                </header>
                
                <section>
                    <h2>\u{1F5A5}\uFE0F Servers (${e.length})</h2>
                    <div class="grid">${i||"<p>No servers found.</p>"}</div>
                </section>
                
                <section>
                    <h2>\u{1F4E6} Applications (${t.length})</h2>
                    <div class="grid">${c||"<p>No applications found.</p>"}</div>
                </section>
                
                <section>
                    <h2>\u{1F5C4}\uFE0F Databases (${o.length})</h2>
                    <div class="grid">${f||"<p>No databases found.</p>"}</div>
                </section>

                <script>
                    const vscode = acquireVsCodeApi();
                    function openLogs(uuid, name) { vscode.postMessage({ type: 'openLogs', uuid, name }); }
                    function openLiveLogs(uuid, name) { vscode.postMessage({ type: 'openLiveLogs', uuid, name }); }
                    function deployApp(uuid) { vscode.postMessage({ type: 'deployApp', uuid }); }
                </script>
            </body>
            </html>
        `}dispose(){for(s.currentPanel=void 0,this._panel.dispose(),this.stopAutoRefresh();this._disposables.length;){let e=this._disposables.pop();e&&e.dispose()}}};function xe(s,e,t,o,n){let a=(i,r)=>s.subscriptions.push(C.commands.registerCommand(i,r));a("coolify.login",async()=>{try{await C.authentication.getSession("coolify",["coolify"],{createIfNone:!0}),await o(),C.window.showInformationMessage("\u{1F389} Signed in to Coolify!")}catch(i){C.window.showErrorMessage(i instanceof Error?i.message:"Login failed")}}),a("coolify.logout",async()=>{await C.authentication.getSession("coolify",["coolify"])&&(await e.clearConfiguration(),await o(),C.window.showInformationMessage("Signed out of Coolify"))}),a("coolify.refreshApplications",async()=>{await t.loadData(),C.window.showInformationMessage("Coolify: Refreshed")}),a("coolify.openDashboard",()=>{Z.createOrShow(s.extensionUri,e)}),a("coolify.startDeployment",(i,r)=>{if(typeof i=="string")return E(e,i,r);if(i?.kind==="application"&&i.rawData){let c=i.rawData;return E(e,c.uuid||c.id||"",c.name)}return Ye(e,t)}),a("coolify.deployCurrentProject",()=>ue(e,n)),a("coolify.forceDeployment",(i,r)=>{if(typeof i=="string")return E(e,i,r,!0);if(i?.kind==="application"&&i.rawData){let c=i.rawData;return E(e,c.uuid||c.id||"",c.name,!0)}return ge(e,t)}),a("coolify.cancelDeployment",()=>fe(e)),a("coolify.startApplication",(i,r)=>{if(typeof i=="string")return R(e,i,r||"Application","start");if(i?.kind==="application"&&i.rawData){let c=i.rawData;return R(e,c.uuid||c.id||"",c.name,"start")}return he(void 0,e)}),a("coolify.stopApplication",(i,r)=>{if(typeof i=="string")return R(e,i,r||"Application","stop");if(i?.kind==="application"&&i.rawData){let c=i.rawData;return R(e,c.uuid||c.id||"",c.name,"stop")}return me(void 0,e)}),a("coolify.restartApplication",(i,r)=>{if(typeof i=="string")return R(e,i,r||"Application","restart");if(i?.kind==="application"&&i.rawData){let c=i.rawData;return R(e,c.uuid||c.id||"",c.name,"restart")}return we(void 0,e)}),a("coolify.viewApplicationLogs",(i,r)=>{if(typeof i=="string")return j(e,{id:i,name:r||"Application"});if(i&&"kind"in i&&i.kind==="application"&&i.rawData){let c=i.rawData;return j(e,{id:c.uuid||c.id||"",name:c.name})}else if(i&&typeof i=="object"&&"id"in i)return j(e,i);return j(e)}),a("coolify.viewApplicationLogsLive",(i,r)=>{if(typeof i=="string")return q(e,{id:i,name:r||"Application"});if(i&&"kind"in i&&i.kind==="application"&&i.rawData){let c=i.rawData;return q(e,{id:c.uuid||c.id||"",name:c.name})}else if(i&&typeof i=="object"&&"id"in i)return q(e,i);return q(e)}),a("coolify.startDatabase",(i,r)=>{if(typeof i=="string")return Q(void 0,e,i,r);if(i?.kind==="database"&&i.rawData){let c=i.rawData;return Q(void 0,e,c.uuid,c.name)}return Q(void 0,e)}),a("coolify.stopDatabase",(i,r)=>{if(typeof i=="string")return J(void 0,e,i,r);if(i?.kind==="database"&&i.rawData){let c=i.rawData;return J(void 0,e,c.uuid,c.name)}return J(void 0,e)}),a("coolify.createDatabaseBackup",(i,r)=>{if(typeof i=="string")return X(e,{id:i,name:r||"Database"});if(i?.kind==="database"&&i.rawData){let c=i.rawData;return X(e,{id:c.uuid,name:c.name})}return X(e)}),a("coolify.openInBrowser",i=>ke(e,t,i)),a("coolify.copyUuid",i=>De(t,i)),a("coolify.quickDeploy",()=>$e(e,t)),a("coolify.testConnection",()=>Pe(e)),Te(s,e,t)}async function Ye(s,e){let t=e.getCachedApplications();if(!t||t.length===0){C.window.showInformationMessage("No applications found");return}let o=await C.window.showQuickPick(t.map(n=>({label:n.name,description:n.status,detail:n.fqdn,id:n.id||n.uuid||""})),{placeHolder:"Select an application to deploy",title:"Start Deployment"});o&&await E(s,o.id,o.label)}async function R(s,e,t,o){let n=await s.getServerUrl(),a=await s.getToken();if(!n||!a)throw new Error("Not configured");let i=new g(n,a);await C.window.withProgress({location:C.ProgressLocation.Notification,title:`${o}ing ${t}...`,cancellable:!1},async()=>{o==="start"?await i.startApplication(e):o==="stop"?await i.stopApplication(e):await i.restartApplication(e),C.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&C.window.showInformationMessage(`\u2705 ${t} ${o}ed`)})}var I=v(require("vscode"));var ze="coolify",Qe="Coolify",Ie="coolify.auth.sessions",O=class{constructor(e,t){this.context=e;this.configManager=t;this._reg=I.authentication.registerAuthenticationProvider(ze,Qe,this,{supportsMultipleAccounts:!1})}_sessions=[];_storedSessions=new Map;_onDidChangeSessions=new I.EventEmitter;onDidChangeSessions=this._onDidChangeSessions.event;_reg;async getSessions(e){return await this._load(),!e||e.length===0?this._sessions:this._sessions.filter(t=>e.every(o=>t.scopes.includes(o)))}async createSession(e){let t=await this.configManager.getServerUrl();if(!t){let a=await I.window.showInputBox({ignoreFocusOut:!0,title:"Connect to Coolify",prompt:"Enter your Coolify server URL",placeHolder:"https://coolify.my-server.com",validateInput:i=>i?null:"URL is required"});if(!a)throw new Error("Cancelled");t=a.replace(/\/$/,""),await this.configManager.setServerUrl(t)}await I.env.openExternal(I.Uri.parse(`${t}/security/api-tokens`));let o=await I.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Paste API Token",prompt:"\u{1F510} Paste your API token from the browser tab that just opened",password:!0,placeHolder:"Paste token here\u2026",validateInput:a=>a?null:"Token is required"});if(!o)throw new Error("Cancelled");if(!await new g(t,o).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");return await this.configManager.setToken(o),this._storeSession(t,o,[...e])}async removeSession(e){let t=this._sessions.find(o=>o.id===e);this._sessions=this._sessions.filter(o=>o.id!==e),this._storedSessions.delete(e),await this._save(),await this.configManager.clearConfiguration(),t&&this._onDidChangeSessions.fire({added:[],removed:[t],changed:[]})}async createSessionFromToken(e,t){await this.configManager.setServerUrl(e),await this.configManager.setToken(t),this._storeSession(e,t,["coolify"])}_storeSession(e,t,o){let n=`coolify-${Date.now()}`,a=Array.from(o),i={id:n,accessToken:t,account:{id:e,label:e.replace(/^https?:\/\//,"")},scopes:a};return this._sessions=[i],this._storedSessions.set(n,{...i,scopes:a,serverUrl:e}),this._save(),this._onDidChangeSessions.fire({added:[i],removed:[],changed:[]}),i}async _load(){let e=this.context.globalState.get(Ie,[]);this._sessions=e.map(t=>({id:t.id,accessToken:t.accessToken,account:t.account,scopes:t.scopes})),e.forEach(t=>this._storedSessions.set(t.id,t))}async _save(){await this.context.globalState.update(Ie,[...this._storedSessions.values()])}dispose(){this._reg.dispose(),this._onDidChangeSessions.dispose()}};var _=v(require("vscode"));var ee=class{constructor(e,t,o){this.authProvider=e;this.configManager=t;this.onAuthenticated=o}async handleUri(e){let t=new URLSearchParams(e.query),o=t.get("token"),n=t.get("url"),a=e.path;if(a==="/auth"||a==="/callback"){if(!o||!n){_.window.showErrorMessage("Coolify: Invalid auth link \u2014 missing token or server URL.");return}let i=decodeURIComponent(n).replace(/\/$/,""),r=decodeURIComponent(o),c=new g(i,r);await _.window.withProgress({location:_.ProgressLocation.Notification,title:`\u{1F510} Authenticating with Coolify at ${i.replace(/^https?:\/\//,"")}\u2026`,cancellable:!1},async()=>{if(!await c.verifyToken()){_.window.showErrorMessage("Coolify: The token from the deep link is invalid or expired.");return}await this.authProvider.createSessionFromToken(i,r),await this.onAuthenticated(),_.window.showInformationMessage(`\u2705 Authenticated with Coolify at ${i.replace(/^https?:\/\//,"")}!`,"Open Sidebar").then(l=>{l==="Open Sidebar"&&_.commands.executeCommand("coolify-deployments.focus")})})}}};function Je(){let s=k.env.appName??"",e=s.toLowerCase();return{name:s,isCursor:e.includes("cursor"),isTrae:e.includes("trae"),isWindsurf:e.includes("windsurf"),isVSCodium:e.includes("vscodium")||e.includes("codium"),isAntigravity:e.includes("antigravity")}}var N,U;function Xe(s){let e=Je();console.log(`[Coolify] Running in: ${e.name}`);let t=k.env.remoteName!==void 0&&k.env.remoteName!=="",o=s.globalState.get("coolify.remoteAdvisoryShown");t&&!o&&k.window.showInformationMessage(`Coolify: You are in a remote session (${k.env.remoteName}). Make sure your Coolify server is reachable FROM this remote host.`,"Got it").then(()=>{s.globalState.update("coolify.remoteAdvisoryShown",!0)});let n=`coolify.greeted.${e.name}`;if(!s.globalState.get(n)){let l=e.isAntigravity?"Antigravity":e.isCursor?"Cursor":e.isTrae?"Trae":e.isWindsurf?"Windsurf":e.isVSCodium?"VSCodium":"VS Code";k.window.showInformationMessage(`\u{1F44B} Coolify Deployments is ready in ${l}! Sign in via the Accounts menu to get started.`,"Sign In","Dismiss").then(p=>{p==="Sign In"&&k.commands.executeCommand("coolify.login")}),s.globalState.update(n,!0)}let a=new W(s);N=new Y(a);let i=k.window.createTreeView("coolify-deployments",{treeDataProvider:N,showCollapseAll:!0});U=new G(a),s.subscriptions.push(i,{dispose:()=>N?.dispose()},{dispose:()=>U?.dispose()});async function r(){let l=await a.isConfigured();await k.commands.executeCommand("setContext","coolify.isConfigured",l),l?(await N?.loadData(),await U?.initialize()):N?.refresh()}r().then(async()=>{N?.initialize(),await a.isConfigured()&&U?.initialize()}),s.subscriptions.push(k.workspace.onDidChangeConfiguration(l=>{l.affectsConfiguration("coolify")&&r()})),xe(s,a,N,r,U);let c=new O(s,a);s.subscriptions.push(c);let f=new ee(c,a,r);s.subscriptions.push(k.window.registerUriHandler(f))}function Ze(){N?.dispose(),U?.dispose()}0&&(module.exports={activate,deactivate});
