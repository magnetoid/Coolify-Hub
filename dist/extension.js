"use strict";var ce=Object.create;var x=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var fe=(i,e)=>{for(var t in e)x(i,t,{get:e[t],enumerable:!0})},F=(i,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of de(e))!ue.call(i,n)&&n!==t&&x(i,n,{get:()=>e[n],enumerable:!(o=le(e,n))||o.enumerable});return i};var C=(i,e,t)=>(t=i!=null?ce(pe(i)):{},F(e||!i||!i.__esModule?x(t,"default",{value:i,enumerable:!0}):t,i)),me=i=>F(x({},"__esModule",{value:!0}),i);var Se={};fe(Se,{activate:()=>Ce,deactivate:()=>be});module.exports=me(Se);var h=C(require("vscode"));var M=C(require("vscode")),_=class i{constructor(e){this.context=e;e.globalState.setKeysForSync([i.SERVER_URL_KEY])}static SERVER_URL_KEY="coolify.serverUrl";static TOKEN_KEY="coolify.token";static TOKEN_FALLBACK_KEY="coolify.token.fallback";static SECRETS_SUPPORTED_KEY="coolify.secretsSupported";secretsAvailable;async isConfigured(){let e=await this.getServerUrl(),t=await this.getToken();return!!e&&!!t}async getServerUrl(){let e=M.workspace.getConfiguration("coolify").get("serverUrl");return e&&e.trim()!==""?e.trim():this.context.globalState.get(i.SERVER_URL_KEY)}async getToken(){return await this.hasSecretsSupport()?this.context.secrets.get(i.TOKEN_KEY):this.context.globalState.get(i.TOKEN_FALLBACK_KEY)}async setServerUrl(e){await this.context.globalState.update(i.SERVER_URL_KEY,e)}async setToken(e){await this.hasSecretsSupport()?await this.context.secrets.store(i.TOKEN_KEY,e):(await this.context.globalState.update(i.TOKEN_FALLBACK_KEY,e),M.window.showWarningMessage("Coolify: Your editor does not support secure secret storage. Your API token has been stored without encryption. Consider upgrading your editor or using a `.env` file."))}async clearConfiguration(){await this.context.globalState.update(i.SERVER_URL_KEY,void 0),await this.hasSecretsSupport()?await this.context.secrets.delete(i.TOKEN_KEY):await this.context.globalState.update(i.TOKEN_FALLBACK_KEY,void 0)}async hasSecretsSupport(){if(this.secretsAvailable!==void 0)return this.secretsAvailable;try{await this.context.secrets.get("__coolify_probe__"),this.secretsAvailable=!0}catch{this.secretsAvailable=!1,console.warn("[Coolify] SecretStorage not available in this editor \u2014 using plaintext fallback.")}return this.secretsAvailable}};var S=C(require("vscode"));var p=class{constructor(e,t){this.baseUrl=e;this.token=t}async fetchWithAuth(e,t){let o=new AbortController,n=setTimeout(()=>o.abort(),15e3);try{let s=await fetch(`${this.baseUrl}${e}`,{...t,headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json",...t?.headers||{}},signal:o.signal});if(!s.ok)throw new Error(`API request failed (${s.status}): ${s.statusText}`);return await s.json()}finally{clearTimeout(n)}}async fetchVoid(e,t="GET"){let o=new AbortController,n=setTimeout(()=>o.abort(),15e3);try{let s=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{Authorization:`Bearer ${this.token}`},signal:o.signal});if(!s.ok)throw new Error(`Request failed (${s.status}): ${s.statusText}`);return!0}finally{clearTimeout(n)}}async getApplications(){return this.fetchWithAuth("/api/v1/applications")}async getApplicationsByEnvironment(e,t){return(await this.fetchWithAuth(`/api/v1/projects/${e}/environment/${t}`)).applications??[]}async getApplicationLogs(e){let t=new AbortController,o=setTimeout(()=>t.abort(),15e3);try{let n=await fetch(`${this.baseUrl}/api/v1/applications/${e}/logs`,{headers:{Authorization:`Bearer ${this.token}`},signal:t.signal});if(!n.ok)throw new Error(`Failed to fetch logs: ${n.statusText}`);return await n.text()}finally{clearTimeout(o)}}async startApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/start`)}async stopApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/stop`)}async restartApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/restart`)}async getDeployments(){return this.fetchWithAuth("/api/v1/deployments")}async getApplicationDeployments(e){return this.fetchWithAuth(`/api/v1/applications/${e}/deployments`)}async startDeployment(e){return this.fetchVoid(`/api/v1/deploy?uuid=${e}`)}async cancelDeployment(e){return this.fetchVoid(`/api/v1/deployments/${e}/cancel`,"POST")}async getProjects(){return this.fetchWithAuth("/api/v1/projects")}async getProjectEnvironments(e){return(await this.fetchWithAuth(`/api/v1/projects/${e}`)).environments??[]}async getServers(){return this.fetchWithAuth("/api/v1/servers")}async getDatabases(){return this.fetchWithAuth("/api/v1/databases")}async startDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/start`)}async stopDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/stop`)}async createDatabaseBackup(e){return this.fetchVoid(`/api/v1/databases/${e}/backup`,"POST")}async verifyToken(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/v1/version`,{headers:{Authorization:`Bearer ${this.token}`},signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async testConnection(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/health`,{signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async getVersion(){let e=await this.fetchWithAuth("/api/v1/version");return typeof e=="string"?e:e.version??"unknown"}};var L=class{constructor(e){this.configManager=e}items=[];pollInterval;isDisposed=!1;async initialize(){await this.refreshStatusBar(),this.startPolling()}startPolling(){let e=S.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.pollInterval=setInterval(async()=>{this.isDisposed||await this.refreshStatusBar()},e)}async refreshStatusBar(){if(this.isDisposed)return;let e=await this.configManager.isConfigured();if(this.clearItems(),!!e)try{let t=await this.configManager.getServerUrl(),o=await this.configManager.getToken();if(!t||!o)return;let s=await new p(t,o).getApplications(),a=S.workspace.getConfiguration("coolify").get("defaultApplication"),c=a?s.filter(r=>r.id===a||r.uuid===a):s.slice(0,2);for(let r of c){let d=S.window.createStatusBarItem(S.StatusBarAlignment.Left,100);d.name=`Coolify \u2014 ${r.name}`;let f=this.getStatusIcon(r.status);d.text=`${f} ${r.name}: ${this.formatStatus(r.status)}`,d.tooltip=new S.MarkdownString(`**Coolify App: ${r.name}**

Status: \`${r.status}\`

Click to view logs`),d.command={title:"View Logs",command:"coolify.viewApplicationLogs",arguments:[{id:r.id||r.uuid,name:r.name}]},this.applyStatusBackground(d,r.status),d.show(),this.items.push(d)}}catch(t){console.error("StatusBarManager: Failed to refresh:",t)}}getStatusIcon(e){switch(e?.toLowerCase()){case"running":return"$(vm-running)";case"stopped":case"exited":return"$(vm-outline)";case"deploying":case"starting":return"$(sync~spin)";case"error":case"failed":return"$(error)";default:return"$(circle-outline)"}}formatStatus(e){return e?e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "):"Unknown"}applyStatusBackground(e,t){switch(t?.toLowerCase()){case"error":case"failed":e.backgroundColor=new S.ThemeColor("statusBarItem.errorBackground");break;case"deploying":case"starting":e.backgroundColor=new S.ThemeColor("statusBarItem.warningBackground");break;default:e.backgroundColor=void 0}}clearItems(){for(let e of this.items)e.dispose();this.items=[]}dispose(){this.isDisposed=!0,this.pollInterval&&clearInterval(this.pollInterval),this.clearItems()}};var l=C(require("vscode"));var m=class extends l.TreeItem{constructor(t,o,n,s,a){super(t,o);this.kind=n;this.rawData=s;this.parentId=a;this.applyKindConfig()}applyKindConfig(){switch(this.kind){case"project":this.iconPath=new l.ThemeIcon("folder"),this.contextValue="coolifyProject";break;case"environment":this.iconPath=new l.ThemeIcon("layers"),this.contextValue="coolifyEnvironment";break;case"application":{let t=this.rawData;this.iconPath=this.getAppIcon(t?.status),this.contextValue=`coolifyApp_${t?.status?.toLowerCase()??"unknown"}`,t?.fqdn&&(this.description=t.fqdn.replace(/^https?:\/\//,"")),this.tooltip=this.buildAppTooltip(t);break}case"server":{let t=this.rawData,o=t?.settings?.is_reachable;this.iconPath=new l.ThemeIcon(o?"server-process":"server-environment"),this.contextValue="coolifyServer",this.description=t?.ip;break}case"database":{let t=this.rawData;this.iconPath=new l.ThemeIcon("database"),this.contextValue=`coolifyDatabase_${t?.status?.toLowerCase()??"unknown"}`,this.description=t?.type;break}case"category":this.iconPath=new l.ThemeIcon("list-unordered"),this.contextValue="coolifyCategory";break;case"loading":this.iconPath=new l.ThemeIcon("loading~spin"),this.contextValue="coolifyLoading";break;case"empty":this.iconPath=new l.ThemeIcon("info"),this.contextValue="coolifyEmpty";break}}getAppIcon(t){switch(t?.toLowerCase()){case"running":return new l.ThemeIcon("vm-running",new l.ThemeColor("charts.green"));case"stopped":case"exited":return new l.ThemeIcon("vm-outline",new l.ThemeColor("charts.gray"));case"deploying":case"starting":return new l.ThemeIcon("sync~spin",new l.ThemeColor("charts.yellow"));case"error":case"failed":return new l.ThemeIcon("error",new l.ThemeColor("charts.red"));default:return new l.ThemeIcon("circle-outline")}}buildAppTooltip(t){if(!t)return new l.MarkdownString("No application data");let o=[`**${t.name}**`,"",`Status: \`${t.status??"unknown"}\``];return t.git_repository&&o.push(`Repo: \`${t.git_repository}\``),t.git_branch&&o.push(`Branch: \`${t.git_branch}\``),t.fqdn&&o.push(`URL: [${t.fqdn}](${t.fqdn})`),new l.MarkdownString(o.join(`
`))}},N=class{constructor(e){this.configManager=e}_onDidChangeTreeData=new l.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refreshInterval;isDisposed=!1;service;cachedProjects=[];cachedApplications=[];cachedServers=[];cachedDatabases=[];isConfigured=!1;async initialize(){await this.loadData(),this.startAutoRefresh()}startAutoRefresh(){let e=l.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.refreshInterval=setInterval(()=>{this.isDisposed||this.loadData().catch(console.error)},e)}async getService(){let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();return!e||!t?null:(this.service=new p(e,t),this.service)}async loadData(){if(this.isConfigured=await this.configManager.isConfigured(),!this.isConfigured){this.refresh();return}try{let e=await this.getService();if(!e)return;let[t,o,n,s]=await Promise.allSettled([e.getProjects(),e.getApplications(),e.getServers(),e.getDatabases()]);this.cachedProjects=t.status==="fulfilled"?t.value:[],this.cachedApplications=o.status==="fulfilled"?o.value:[],this.cachedServers=n.status==="fulfilled"?n.value:[],this.cachedDatabases=s.status==="fulfilled"?s.value:[],this.refresh()}catch(e){console.error("CoolifyTreeDataProvider: Failed to load data:",e)}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!this.isConfigured)return[new m("Not configured \u2014 run Coolify: Configure",l.TreeItemCollapsibleState.None,"empty")];if(!e)return[new m("Applications",l.TreeItemCollapsibleState.Expanded,"category"),new m("Servers",l.TreeItemCollapsibleState.Collapsed,"category"),new m("Databases",l.TreeItemCollapsibleState.Collapsed,"category")];if(e.kind==="category")return this.getCategoryChildren(e.label);if(e.kind==="project"){let t=e.rawData;return!t.environments||t.environments.length===0?[new m("No environments",l.TreeItemCollapsibleState.None,"empty")]:t.environments.map(o=>new m(o.name,l.TreeItemCollapsibleState.Collapsed,"environment",o,String(t.uuid)))}if(e.kind==="environment"){let t=e.rawData,o=this.cachedApplications.filter(n=>t.applications?t.applications.some(s=>s.id===n.id):!0);return o.length===0?[new m("No applications",l.TreeItemCollapsibleState.None,"empty")]:o.map(n=>new m(n.name,l.TreeItemCollapsibleState.None,"application",n))}return[]}getCategoryChildren(e){switch(e){case"Applications":return this.cachedApplications.length===0?[new m("No applications found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedApplications.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"application",t));case"Servers":return this.cachedServers.length===0?[new m("No servers found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedServers.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"server",t));case"Databases":return this.cachedDatabases.length===0?[new m("No databases found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedDatabases.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"database",t));default:return[]}}getService_(){return this.service}getCachedApplications(){return this.cachedApplications}getCachedDatabases(){return this.cachedDatabases}dispose(){this.isDisposed=!0,this.refreshInterval&&clearInterval(this.refreshInterval),this._onDidChangeTreeData.dispose()}};var b=C(require("vscode"));var v=C(require("vscode"));function Y(i){try{!i.startsWith("http://")&&!i.startsWith("https://")&&(i="http://"+i);let e=new URL(i),t=e.hostname,o=t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)||t.includes(".");return t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)?!!e.port:o}catch{return!1}}function H(i){return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="http://"+i),i.replace(/\/$/,"")}async function z(i,e){try{let t=await v.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Step 1 of 2",prompt:"Enter your Coolify server URL",placeHolder:"e.g., https://coolify.my-server.com or http://127.0.0.1:8000",validateInput:g=>g?Y(g)?null:"Invalid URL format":"Server URL is required"});if(!t)return;let o=H(t);if(!await new p(o,"").testConnection())throw new Error("Could not reach the Coolify server. Check the URL and try again.");let a=`${o}/security/api-tokens`,c=await v.window.showInformationMessage(`\u2705 Connected to Coolify at ${o.replace(/^https?:\/\//,"")}! Open the API token page in your browser?`,{modal:!1},"Open Token Page","I already have a token");c==="Open Token Page"&&await v.env.openExternal(v.Uri.parse(a));let r=await v.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Step 2 of 2",prompt:c==="Open Token Page"?"\u{1F510} Paste your API token from the browser tab that just opened":"Enter your Coolify API token",password:!0,placeHolder:"Paste API token here\u2026",validateInput:g=>g?null:"Token is required"});if(!r)return;if(!await new p(o,r).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");await i.setServerUrl(o),await i.setToken(r),await e(),v.window.showInformationMessage("\u{1F389} Coolify configured! Your workspace is now connected.","Open Sidebar").then(g=>{g==="Open Sidebar"&&v.commands.executeCommand("coolify-deployments.focus")})}catch(t){v.window.showErrorMessage(t instanceof Error?t.message:"Configuration failed. Please try again.")}}async function Q(i,e){await v.window.showWarningMessage("This will clear your existing Coolify configuration. Continue?","Yes, reconfigure","Cancel")==="Yes, reconfigure"&&(await i.clearConfiguration(),await e(),await v.commands.executeCommand("coolify.configure"))}var T=C(require("vscode"));async function G(i){try{let e=await i.getServerUrl(),t=await i.getToken();if(!e||!t)throw new Error("Extension not configured properly");let o=new p(e,t),s=(await o.getDeployments()).filter(c=>c.status==="in_progress"||c.status==="queued");if(!s||s.length===0){T.window.showInformationMessage("No active deployments found");return}let a=await T.window.showQuickPick(s.map(c=>({label:`Cancel: ${c.application_name||"Deployment"}`,description:c.status,detail:c.commit_message||`Deployment ID: ${c.id}`,id:c.id})),{placeHolder:"Select a deployment to cancel",title:"Cancel Deployment"});a&&T.window.withProgress({location:T.ProgressLocation.Notification,title:`Canceling ${a.label}...`,cancellable:!1},async()=>{await o.cancelDeployment(a.id),T.window.showInformationMessage("Successfully canceled deployment.")})}catch(e){T.window.showErrorMessage(e instanceof Error?e.message:"Failed to cancel deployment")}}var I=C(require("vscode"));async function K(i,e,t,o,n){try{let s=await i.getServerUrl(),a=await i.getToken();if(!s||!a)throw new Error("Extension not configured properly");let c=new p(s,a),r=o,d=n;if(!r){let f=await c.getApplications();if(!f||f.length===0){I.window.showInformationMessage("No applications found");return}let g=await I.window.showQuickPick(f.map(w=>({label:w.name,description:w.status,detail:`Status: ${w.status}`,id:w.id||w.uuid||""})),{placeHolder:`Select an application to ${e}`,title:t});if(!g)return;r=g.id,d=g.label}await I.window.withProgress({location:I.ProgressLocation.Notification,title:`${e}ing ${d}...`,cancellable:!1},async()=>{e==="start"?await c.startApplication(r):e==="stop"?await c.stopApplication(r):await c.restartApplication(r),I.window.showInformationMessage(`\u2705 Successfully ${e}ed ${d}`)})}catch(s){I.window.showErrorMessage(s instanceof Error?s.message:`Failed to ${e} application`)}}async function J(i,e,t,o){await K(e,"start","Start Application",t,o)}async function X(i,e,t,o){await K(e,"stop","Stop Application",t,o)}async function Z(i,e,t,o){await K(e,"restart","Restart Application",t,o)}var y=C(require("vscode"));var q;function he(){return q||(q=y.window.createOutputChannel("Coolify Logs")),q}async function R(i,e){try{let t=await i.getServerUrl(),o=await i.getToken();if(!t||!o)throw new Error("Extension not configured properly");let n=new p(t,o),s=e?.id,a=e?.name;if(!s){let r=await n.getApplications();if(!r||r.length===0){y.window.showInformationMessage("No applications found");return}let d=await y.window.showQuickPick(r.map(f=>({label:f.name,description:f.status,detail:f.fqdn,id:f.id||f.uuid||""})),{placeHolder:"Select an application to view logs",title:"Coolify: View Logs"});if(!d)return;s=d.id,a=d.label}let c=he();c.clear(),c.show(!0),c.appendLine(`\u2500\u2500 Coolify Logs \u2014 ${a} \u2500\u2500`),c.appendLine(`Fetching logs from ${t}...`),c.appendLine(""),await y.window.withProgress({location:y.ProgressLocation.Notification,title:`Fetching logs for ${a}...`,cancellable:!1},async()=>{let r=await n.getApplicationLogs(s);c.appendLine(r||"(No log output)")})}catch(t){y.window.showErrorMessage(t instanceof Error?t.message:"Failed to fetch logs")}}async function j(i,e){try{let t=await i.getServerUrl(),o=await i.getToken();if(!t||!o)throw new Error("Extension not configured properly");let n=new p(t,o),s=e?.id,a=e?.name;if(!s){let c=await n.getDatabases();if(!c||c.length===0){y.window.showInformationMessage("No databases found");return}let r=await y.window.showQuickPick(c.map(d=>({label:d.name,description:d.type,detail:d.status,id:d.uuid})),{placeHolder:"Select a database to back up",title:"Coolify: Create Database Backup"});if(!r)return;s=r.id,a=r.label}await y.window.withProgress({location:y.ProgressLocation.Notification,title:`Creating backup for ${a}...`,cancellable:!1},async()=>{await n.createDatabaseBackup(s),y.window.showInformationMessage(`\u2705 Backup created for ${a}`)})}catch(t){y.window.showErrorMessage(t instanceof Error?t.message:"Failed to create backup")}}var u=C(require("vscode"));async function ee(i,e,t){let o,n="";if(t?.kind==="application"&&t.rawData){let a=t.rawData;o=a.fqdn,n=a.name}else{let a=e.getCachedApplications().filter(r=>!!r.fqdn);if(a.length===0){u.window.showInformationMessage("No applications have a public URL configured in Coolify.");return}let c=await u.window.showQuickPick(a.map(r=>({label:r.name,description:r.fqdn.replace(/^https?:\/\//,""),detail:`Status: ${r.status??"unknown"}`,fqdn:r.fqdn})),{placeHolder:"Select an application to open",title:"Open in Browser"});if(!c)return;o=c.fqdn,n=c.label}if(!o){u.window.showWarningMessage(`${n} has no public URL configured in Coolify.`);return}let s=u.Uri.parse(o.startsWith("http")?o:`https://${o}`);await u.env.openExternal(s)}async function te(i,e){let t,o="";if(e?.rawData){let n=e.rawData;t=n.uuid??n.uuid,o=n.name??n.name}else{let n=i.getCachedApplications(),s=i.getCachedDatabases(),a=[...n.map(r=>({label:r.name,description:`App \xB7 ${r.uuid}`,uuid:r.uuid})),...s.map(r=>({label:r.name,description:`DB \xB7 ${r.uuid}`,uuid:r.uuid}))];if(a.length===0){u.window.showInformationMessage("No resources found to copy UUID from.");return}let c=await u.window.showQuickPick(a,{placeHolder:"Select a resource to copy its UUID",title:"Copy UUID"});if(!c)return;t=c.uuid,o=c.label}if(!t){u.window.showWarningMessage("UUID not available for this resource.");return}await u.env.clipboard.writeText(t),u.window.showInformationMessage(`\u2705 UUID for "${o}" copied to clipboard!`)}async function oe(i,e){let t=e.getCachedApplications();if(t.length===0){u.window.showInformationMessage("No applications found. Try refreshing.");return}let o=r=>{switch(r?.toLowerCase()){case"running":return"\u{1F7E2}";case"stopped":case"exited":return"\u{1F534}";case"deploying":case"starting":return"\u{1F7E1}";case"error":case"failed":return"\u274C";default:return"\u26AA"}},n=await u.window.showQuickPick(t.map(r=>({label:`${o(r.status)} ${r.name}`,description:r.fqdn?.replace(/^https?:\/\//,"")??"",detail:`Status: ${r.status??"unknown"} \xB7 ${r.git_branch?`Branch: ${r.git_branch}`:""}`,uuid:r.uuid??r.id??"",name:r.name})),{placeHolder:"Type to filter, select to deploy immediately",title:"\u26A1 Quick Deploy",matchOnDescription:!0,matchOnDetail:!0});if(!n)return;let s=await i.getServerUrl(),a=await i.getToken();if(!s||!a){u.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let c=new p(s,a);await u.window.withProgress({location:u.ProgressLocation.Notification,title:`\u{1F680} Deploying ${n.name}\u2026`,cancellable:!1},async()=>{try{await c.startDeployment(n.uuid),u.window.showInformationMessage(`\u{1F680} ${n.name} deployment started!`,"View Logs").then(r=>{r==="View Logs"&&u.commands.executeCommand("coolify.viewApplicationLogs",{id:n.uuid,name:n.name})})}catch(r){u.window.showErrorMessage(`Deploy failed: ${r instanceof Error?r.message:String(r)}`)}})}async function ie(i){let e=await i.getServerUrl(),t=await i.getToken();if(!e||!t){u.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}await u.window.withProgress({location:u.ProgressLocation.Notification,title:"Testing Coolify connection\u2026",cancellable:!1},async()=>{try{let n=await new p(e,t).getVersion();u.window.showInformationMessage(`\u2705 Connected to Coolify v${n} at ${e.replace(/^https?:\/\//,"")}`)}catch(o){u.window.showErrorMessage(`\u274C Connection failed: ${o instanceof Error?o.message:String(o)}`)}})}var A=C(require("vscode"));function se(i,e,t){let o=A.extensions.getExtension("vscode.git");if(!o)return;let n=o.isActive?o.exports:null;if(!n)return;let s=n.getAPI(1);if(s?.repositories?.length)for(let a of s.repositories)i.subscriptions.push(a.state.onDidChange(async()=>{let c=a.state.HEAD?.name;if(!c||!await e.isConfigured())return;let d=t.getCachedApplications().filter(w=>w.git_branch===c&&w.status!=="deploying");if(d.length===0)return;let f=`coolify.gitAdvisor.${c}`,g=i.globalState.get(f)??0;if(!(Date.now()-g<3e4))if(await i.globalState.update(f,Date.now()),d.length===1){let w=d[0];await A.window.showInformationMessage(`Coolify: "${w.name}" is configured to deploy from \`${c}\`. Deploy now?`,"Deploy","Dismiss")==="Deploy"&&A.commands.executeCommand("coolify.startDeployment",{kind:"application",rawData:w})}else{let w=await e.getServerUrl(),O=await e.getToken();if(!w||!O)return;let U=await A.window.showQuickPick(d.map(E=>({label:E.name,description:E.fqdn??"",detail:`Branch: ${E.git_branch}`,uuid:E.uuid??E.id??""})),{title:`Deploy from ${c}?`,placeHolder:"Select an app to deploy (Escape to skip)"});if(U){let E=new p(w,O);await A.window.withProgress({location:A.ProgressLocation.Notification,title:`\u{1F680} Deploying ${U.label}\u2026`,cancellable:!1},async()=>{await E.startDeployment(U.uuid),A.window.showInformationMessage(`\u{1F680} ${U.label} deployment started!`)})}}}))}function ne(i,e,t,o){let n=(s,a)=>i.subscriptions.push(b.commands.registerCommand(s,a));n("coolify.configure",()=>z(e,o)),n("coolify.reconfigure",()=>Q(e,o)),n("coolify.refreshApplications",async()=>{await t.loadData(),b.window.showInformationMessage("Coolify: Refreshed")}),n("coolify.startDeployment",s=>{if(s?.kind==="application"&&s.rawData){let a=s.rawData;return ae(e,a.id||a.uuid||"")}return ge(e,t)}),n("coolify.cancelDeployment",()=>G(e)),n("coolify.startApplication",s=>{if(s?.kind==="application"&&s.rawData){let a=s.rawData;return W(e,a.id||a.uuid||"",a.name,"start")}return J(void 0,e)}),n("coolify.stopApplication",s=>{if(s?.kind==="application"&&s.rawData){let a=s.rawData;return W(e,a.id||a.uuid||"",a.name,"stop")}return X(void 0,e)}),n("coolify.restartApplication",s=>{if(s?.kind==="application"&&s.rawData){let a=s.rawData;return W(e,a.id||a.uuid||"",a.name,"restart")}return Z(void 0,e)}),n("coolify.viewApplicationLogs",s=>{if(s&&"kind"in s&&s.kind==="application"&&s.rawData){let a=s.rawData;return R(e,{id:a.id||a.uuid||"",name:a.name})}return s&&"id"in s?R(e,s):R(e)}),n("coolify.createDatabaseBackup",s=>{if(s?.kind==="database"&&s.rawData){let a=s.rawData;return j(e,{id:a.uuid,name:a.name})}return j(e)}),n("coolify.openInBrowser",s=>ee(e,t,s)),n("coolify.copyUuid",s=>te(t,s)),n("coolify.quickDeploy",()=>oe(e,t)),n("coolify.testConnection",()=>ie(e)),se(i,e,t)}async function ge(i,e){let t=e.getCachedApplications();if(!t||t.length===0){b.window.showInformationMessage("No applications found");return}let o=await b.window.showQuickPick(t.map(n=>({label:n.name,description:n.status,detail:n.fqdn,id:n.id||n.uuid||""})),{placeHolder:"Select an application to deploy",title:"Start Deployment"});o&&await ae(i,o.id)}async function ae(i,e){let t=await i.getServerUrl(),o=await i.getToken();if(!t||!o)throw new Error("Not configured");let n=new p(t,o);await b.window.withProgress({location:b.ProgressLocation.Notification,title:"Starting deployment...",cancellable:!1},async()=>{await n.startDeployment(e),b.window.showInformationMessage("\u{1F680} Deployment started!")})}async function W(i,e,t,o){let n=await i.getServerUrl(),s=await i.getToken();if(!n||!s)throw new Error("Not configured");let a=new p(n,s);await b.window.withProgress({location:b.ProgressLocation.Notification,title:`${o}ing ${t}...`,cancellable:!1},async()=>{o==="start"?await a.startApplication(e):o==="stop"?await a.stopApplication(e):await a.restartApplication(e),b.window.showInformationMessage(`\u2705 ${t} ${o}ed`)})}var k=C(require("vscode"));var we="coolify",ve="Coolify",re="coolify.auth.sessions",B=class{constructor(e,t){this.context=e;this.configManager=t;this._reg=k.authentication.registerAuthenticationProvider(we,ve,this,{supportsMultipleAccounts:!1})}_sessions=[];_storedSessions=new Map;_onDidChangeSessions=new k.EventEmitter;onDidChangeSessions=this._onDidChangeSessions.event;_reg;async getSessions(e){return await this._load(),!e||e.length===0?this._sessions:this._sessions.filter(t=>e.every(o=>t.scopes.includes(o)))}async createSession(e){let t=await this.configManager.getServerUrl();if(!t){let s=await k.window.showInputBox({ignoreFocusOut:!0,title:"Connect to Coolify",prompt:"Enter your Coolify server URL",placeHolder:"https://coolify.my-server.com",validateInput:a=>a?null:"URL is required"});if(!s)throw new Error("Cancelled");t=s.replace(/\/$/,""),await this.configManager.setServerUrl(t)}await k.env.openExternal(k.Uri.parse(`${t}/security/api-tokens`));let o=await k.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Paste API Token",prompt:"\u{1F510} Paste your API token from the browser tab that just opened",password:!0,placeHolder:"Paste token here\u2026",validateInput:s=>s?null:"Token is required"});if(!o)throw new Error("Cancelled");if(!await new p(t,o).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");return await this.configManager.setToken(o),this._storeSession(t,o,[...e])}async removeSession(e){let t=this._sessions.find(o=>o.id===e);this._sessions=this._sessions.filter(o=>o.id!==e),this._storedSessions.delete(e),await this._save(),await this.configManager.clearConfiguration(),t&&this._onDidChangeSessions.fire({added:[],removed:[t],changed:[]})}async createSessionFromToken(e,t){await this.configManager.setServerUrl(e),await this.configManager.setToken(t),this._storeSession(e,t,["coolify"])}_storeSession(e,t,o){let n=`coolify-${Date.now()}`,s=Array.from(o),a={id:n,accessToken:t,account:{id:e,label:e.replace(/^https?:\/\//,"")},scopes:s};return this._sessions=[a],this._storedSessions.set(n,{...a,scopes:s,serverUrl:e}),this._save(),this._onDidChangeSessions.fire({added:[a],removed:[],changed:[]}),a}async _load(){let e=this.context.globalState.get(re,[]);this._sessions=e.map(t=>({id:t.id,accessToken:t.accessToken,account:t.account,scopes:t.scopes})),e.forEach(t=>this._storedSessions.set(t.id,t))}async _save(){await this.context.globalState.update(re,[...this._storedSessions.values()])}dispose(){this._reg.dispose(),this._onDidChangeSessions.dispose()}};var D=C(require("vscode"));var V=class{constructor(e,t,o){this.authProvider=e;this.configManager=t;this.onAuthenticated=o}async handleUri(e){let t=new URLSearchParams(e.query),o=t.get("token"),n=t.get("url"),s=e.path;if(s==="/auth"||s==="/callback"){if(!o||!n){D.window.showErrorMessage("Coolify: Invalid auth link \u2014 missing token or server URL.");return}let a=decodeURIComponent(n).replace(/\/$/,""),c=decodeURIComponent(o),r=new p(a,c);await D.window.withProgress({location:D.ProgressLocation.Notification,title:`\u{1F510} Authenticating with Coolify at ${a.replace(/^https?:\/\//,"")}\u2026`,cancellable:!1},async()=>{if(!await r.verifyToken()){D.window.showErrorMessage("Coolify: The token from the deep link is invalid or expired.");return}await this.authProvider.createSessionFromToken(a,c),await this.onAuthenticated(),D.window.showInformationMessage(`\u2705 Authenticated with Coolify at ${a.replace(/^https?:\/\//,"")}!`,"Open Sidebar").then(f=>{f==="Open Sidebar"&&D.commands.executeCommand("coolify-deployments.focus")})})}}};function ye(){let i=h.env.appName??"",e=i.toLowerCase();return{name:i,isCursor:e.includes("cursor"),isTrae:e.includes("trae"),isWindsurf:e.includes("windsurf"),isVSCodium:e.includes("vscodium")||e.includes("codium"),isAntigravity:e.includes("antigravity")}}var P,$;function Ce(i){let e=ye();console.log(`[Coolify] Running in: ${e.name}`);let t=h.env.remoteName!==void 0&&h.env.remoteName!=="",o=i.globalState.get("coolify.remoteAdvisoryShown");t&&!o&&h.window.showInformationMessage(`Coolify: You are in a remote session (${h.env.remoteName}). Make sure your Coolify server is reachable FROM this remote host.`,"Got it").then(()=>{i.globalState.update("coolify.remoteAdvisoryShown",!0)});let n=`coolify.greeted.${e.name}`;if(!i.globalState.get(n)){let f=e.isAntigravity?"Antigravity":e.isCursor?"Cursor":e.isTrae?"Trae":e.isWindsurf?"Windsurf":e.isVSCodium?"VSCodium":"VS Code";h.window.showInformationMessage(`\u{1F44B} Coolify Deployments is ready in ${f}! Run "Coolify: Configure" to connect to your server.`,"Configure Now","Dismiss").then(g=>{g==="Configure Now"&&h.commands.executeCommand("coolify.configure")}),i.globalState.update(n,!0)}let s=new _(i);P=new N(s);let a=h.window.createTreeView("coolify-deployments",{treeDataProvider:P,showCollapseAll:!0});$=new L(s),i.subscriptions.push(a,{dispose:()=>P?.dispose()},{dispose:()=>$?.dispose()});async function c(){let f=await s.isConfigured();await h.commands.executeCommand("setContext","coolify.isConfigured",f),f?(await P?.loadData(),await $?.initialize()):P?.refresh()}c().then(()=>{P?.initialize(),$?.initialize()}),i.subscriptions.push(h.workspace.onDidChangeConfiguration(f=>{f.affectsConfiguration("coolify")&&c()})),ne(i,s,P,c);let r=new B(i,s);i.subscriptions.push(r);let d=new V(r,s,c);i.subscriptions.push(h.window.registerUriHandler(d))}function be(){P?.dispose(),$?.dispose()}0&&(module.exports={activate,deactivate});
